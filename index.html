<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1e293b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiR2VsaXItR2lkZXIgVGFraWJpIiwic2hvcnRfbmFtZSI6IkdlbGlyLUdpZGVyIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxZTI5M2IiLCJ0aGVtZV9jb2xvciI6IiMxZTI5M2IiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sLDxzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCc+PHRleHQgeT0nLjllbScgZm9udC1zaXplPSc5MCc+8J+SsDwvdGV4dD48L3N2Zz4iLCJzaXplcyI6ImFueSIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
  <title>Gelir-Gider Takibi</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <style>
    /* ==================== 3D BUTON EFEKTLERƒ∞ ==================== */
    /* Genel buton stilleri */
    button {
      transition: all 0.15s ease;
      transform-style: preserve-3d;
    }
    
    /* Primary butonlar (emerald, indigo, blue vb.) */
    .btn-3d, 
    button[class*="bg-emerald-500"],
    button[class*="bg-indigo-500"],
    button[class*="bg-blue-500"],
    button[class*="bg-rose-500"],
    button[class*="bg-orange-500"],
    button[class*="bg-amber-500"],
    button[class*="bg-cyan-500"],
    button[class*="bg-purple-500"] {
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.25), 
                  0 6px 12px rgba(0, 0, 0, 0.15),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2);
      transform: translateY(0);
    }
    
    button[class*="bg-emerald-500"]:hover,
    button[class*="bg-indigo-500"]:hover,
    button[class*="bg-blue-500"]:hover,
    button[class*="bg-rose-500"]:hover,
    button[class*="bg-orange-500"]:hover,
    button[class*="bg-amber-500"]:hover,
    button[class*="bg-cyan-500"]:hover,
    button[class*="bg-purple-500"]:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 0 rgba(0, 0, 0, 0.25), 
                  0 10px 20px rgba(0, 0, 0, 0.2),
                  inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }
    
    button[class*="bg-emerald-500"]:active,
    button[class*="bg-indigo-500"]:active,
    button[class*="bg-blue-500"]:active,
    button[class*="bg-rose-500"]:active,
    button[class*="bg-orange-500"]:active,
    button[class*="bg-amber-500"]:active,
    button[class*="bg-cyan-500"]:active,
    button[class*="bg-purple-500"]:active {
      transform: translateY(0);
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.25), 
                  0 3px 6px rgba(0, 0, 0, 0.15),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    /* Secondary butonlar (bg-white/5, bg-slate vb.) */
    button[class*="bg-white/5"],
    button[class*="bg-white/10"],
    button[class*="bg-slate-600"],
    button[class*="bg-slate-700"],
    button[class*="bg-gray"] {
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2), 
                  0 4px 8px rgba(0, 0, 0, 0.1),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    button[class*="bg-white/5"]:hover,
    button[class*="bg-white/10"]:hover,
    button[class*="bg-slate-600"]:hover,
    button[class*="bg-slate-700"]:hover,
    button[class*="bg-gray"]:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2), 
                  0 6px 12px rgba(0, 0, 0, 0.15),
                  inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }
    
    button[class*="bg-white/5"]:active,
    button[class*="bg-white/10"]:active,
    button[class*="bg-slate-600"]:active,
    button[class*="bg-slate-700"]:active,
    button[class*="bg-gray"]:active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 
                  0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    /* Gradient butonlar */
    button[class*="bg-gradient"] {
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3), 
                  0 8px 16px rgba(0, 0, 0, 0.2),
                  inset 0 2px 0 rgba(255, 255, 255, 0.2);
    }
    
    button[class*="bg-gradient"]:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 0 rgba(0, 0, 0, 0.3), 
                  0 12px 24px rgba(0, 0, 0, 0.25),
                  inset 0 2px 0 rgba(255, 255, 255, 0.3);
    }
    
    button[class*="bg-gradient"]:active {
      transform: translateY(0);
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.3), 
                  0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    /* Tab butonlarƒ± */
    button[class*="rounded-xl"][class*="py-3"][class*="px-4"] {
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.15), 
                  0 4px 8px rgba(0, 0, 0, 0.08);
    }
    
    button[class*="rounded-xl"][class*="py-3"][class*="px-4"]:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.15), 
                  0 6px 12px rgba(0, 0, 0, 0.12);
    }
    
    /* K√º√ß√ºk ikonlu butonlar */
    button[class*="p-2"] {
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.15), 
                  0 3px 6px rgba(0, 0, 0, 0.1);
    }
    
    button[class*="p-2"]:hover {
      transform: translateY(-1px) scale(1.05);
      box-shadow: 0 3px 0 rgba(0, 0, 0, 0.15), 
                  0 5px 10px rgba(0, 0, 0, 0.15);
    }
    
    button[class*="p-2"]:active {
      transform: translateY(1px) scale(0.95);
    }
    
    /* Light tema i√ßin g√∂lge ayarlarƒ± */
    .theme-light button[class*="bg-emerald-500"],
    .theme-light button[class*="bg-indigo-500"],
    .theme-light button[class*="bg-blue-500"],
    .theme-light button[class*="bg-rose-500"],
    .theme-light button[class*="bg-orange-500"],
    .theme-light button[class*="bg-amber-500"],
    .theme-light button[class*="bg-cyan-500"],
    .theme-light button[class*="bg-purple-500"] {
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2), 
                  0 6px 12px rgba(0, 0, 0, 0.12),
                  inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    
    .theme-light button[class*="bg-white/5"],
    .theme-light button[class*="bg-slate"] {
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.1), 
                  0 4px 8px rgba(0, 0, 0, 0.06),
                  inset 0 1px 0 rgba(255, 255, 255, 0.5);
    }
    
    /* Disabled butonlar i√ßin efekti kaldƒ±r */
    button:disabled {
      transform: none !important;
      box-shadow: none !important;
      opacity: 0.5;
    }
    
    /* ==================== TEMA DEƒûƒ∞≈ûKENLERƒ∞ ==================== */
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --bg-card: rgba(30, 41, 59, 0.5);
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-color: rgba(255, 255, 255, 0.1);
      --accent-green: #10b981;
      --accent-green-light: rgba(16, 185, 129, 0.2);
      --accent-red: #ef4444;
      --accent-red-light: rgba(239, 68, 68, 0.2);
      --accent-blue: #3b82f6;
      --accent-blue-light: rgba(59, 130, 246, 0.2);
      --accent-orange: #f97316;
      --accent-orange-light: rgba(249, 115, 22, 0.2);
      --accent-purple: #8b5cf6;
      --accent-purple-light: rgba(139, 92, 246, 0.2);
      --accent-cyan: #06b6d4;
      --accent-cyan-light: rgba(6, 182, 212, 0.2);
      --accent-amber: #f59e0b;
      --accent-amber-light: rgba(245, 158, 11, 0.2);
    }
    
    /* Light Mode */
    .theme-light {
      --bg-primary: #ffffff;
      --bg-secondary: #ffffff;
      --bg-tertiary: #e2e8f0;
      --bg-card: rgba(255, 255, 255, 0.8);
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --border-color: rgba(0, 0, 0, 0.1);
    }
    
    /* Canlƒ± Renkler Modu */
    .theme-vivid {
      --accent-green: #22c55e;
      --accent-green-light: rgba(34, 197, 94, 0.25);
      --accent-red: #f43f5e;
      --accent-red-light: rgba(244, 63, 94, 0.25);
      --accent-blue: #0ea5e9;
      --accent-blue-light: rgba(14, 165, 233, 0.25);
      --accent-orange: #fb923c;
      --accent-orange-light: rgba(251, 146, 60, 0.25);
      --accent-purple: #a855f7;
      --accent-purple-light: rgba(168, 85, 247, 0.25);
      --accent-cyan: #22d3ee;
      --accent-cyan-light: rgba(34, 211, 238, 0.25);
      --accent-amber: #fbbf24;
      --accent-amber-light: rgba(251, 191, 36, 0.25);
    }
    
    

    /* Muayenehane / Klinik Temasƒ± (Premium, sakin) */
    .theme-clinic {
      --accent-green: #16a34a;
      --accent-green-light: rgba(22, 163, 74, 0.22);
      --accent-red: #dc2626;
      --accent-red-light: rgba(220, 38, 38, 0.20);
      --accent-blue: #2563eb;
      --accent-blue-light: rgba(37, 99, 235, 0.18);
      --accent-orange: #ea580c;
      --accent-orange-light: rgba(234, 88, 12, 0.18);
      --accent-purple: #7c3aed;
      --accent-purple-light: rgba(124, 58, 237, 0.18);
      --accent-cyan: #0891b2;
      --accent-cyan-light: rgba(8, 145, 178, 0.18);
      --accent-amber: #d97706;
      --accent-amber-light: rgba(217, 119, 6, 0.18);

      --bg-primary: #0b1220;
      --bg-secondary: #111827;
      --bg-tertiary: #1f2937;
      --bg-card: rgba(17, 24, 39, 0.86);

      --text-primary: #f8fafc;
      --text-secondary: #a1a1aa;
      --text-muted: #94a3b8;

      --border-color: rgba(255, 255, 255, 0.08);
    }
/* Canlƒ± Renkler i√ßin Tailwind Override */
    .theme-vivid .bg-emerald-500 { background-color: #22c55e !important; }
    .theme-vivid .bg-emerald-600 { background-color: #16a34a !important; }
    .theme-vivid .bg-rose-500 { background-color: #f43f5e !important; }
    .theme-vivid .bg-rose-600 { background-color: #e11d48 !important; }
    .theme-vivid .bg-blue-500 { background-color: #0ea5e9 !important; }
    .theme-vivid .bg-blue-600 { background-color: #0284c7 !important; }
    .theme-vivid .bg-indigo-500 { background-color: #6366f1 !important; }
    .theme-vivid .bg-indigo-600 { background-color: #4f46e5 !important; }
    .theme-vivid .bg-orange-500 { background-color: #f97316 !important; }
    .theme-vivid .bg-orange-600 { background-color: #ea580c !important; }
    .theme-vivid .bg-amber-500 { background-color: #f59e0b !important; }
    .theme-vivid .bg-amber-600 { background-color: #d97706 !important; }
    .theme-vivid .bg-cyan-500 { background-color: #06b6d4 !important; }
    .theme-vivid .bg-cyan-600 { background-color: #0891b2 !important; }
    .theme-vivid .bg-purple-500 { background-color: #a855f7 !important; }
    .theme-vivid .bg-purple-600 { background-color: #9333ea !important; }
    
    .theme-vivid .text-emerald-400 { color: #34d399 !important; }
    .theme-vivid .text-emerald-500 { color: #22c55e !important; }
    .theme-vivid .text-rose-400 { color: #fb7185 !important; }
    .theme-vivid .text-rose-500 { color: #f43f5e !important; }
    .theme-vivid .text-blue-400 { color: #38bdf8 !important; }
    .theme-vivid .text-orange-400 { color: #fb923c !important; }
    .theme-vivid .text-amber-400 { color: #fbbf24 !important; }
    .theme-vivid .text-cyan-400 { color: #22d3ee !important; }
    
    /* Light tema i√ßin buton renkleri - daha okunabilir */
    .theme-light .bg-white\/5 { background-color: rgba(0, 0, 0, 0.05) !important; }
    .theme-light .bg-white\/10 { background-color: rgba(0, 0, 0, 0.08) !important; }
    .theme-light .border-white\/10 { border-color: rgba(0, 0, 0, 0.15) !important; }
    .theme-light .text-white { color: #1e293b !important; }
    .theme-light .text-gray-300 { color: #334155 !important; }
    .theme-light .text-gray-400 { color: #475569 !important; }
    .theme-light .text-gray-500 { color: #64748b !important; }
    .theme-light .text-gray-600 { color: #475569 !important; }
    .theme-light .bg-slate-900 { background-color: #f1f5f9 !important; }
    .theme-light .bg-slate-800 { background-color: #ffffff !important; box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important; }
    .theme-light .bg-slate-700 { background-color: #e2e8f0 !important; }
    .theme-light .bg-slate-800\/50 { background-color: rgba(255, 255, 255, 0.9) !important; box-shadow: 0 1px 3px rgba(0,0,0,0.08) !important; }
    .theme-light .bg-black\/70 { background-color: rgba(0, 0, 0, 0.5) !important; }
    .theme-light .from-slate-900 { --tw-gradient-from: #e2e8f0 !important; }
    .theme-light .via-slate-800 { --tw-gradient-stops: var(--tw-gradient-from), #f1f5f9, var(--tw-gradient-to) !important; }
    .theme-light .to-slate-900 { --tw-gradient-to: #e2e8f0 !important; }
    
    /* Light tema input alanlarƒ± */
    .theme-light input, .theme-light select, .theme-light textarea {
      background-color: #f8fafc !important;
      border-color: #cbd5e1 !important;
      color: #1e293b !important;
    }
    .theme-light input::placeholder { color: #94a3b8 !important; }
    .theme-light input:focus, .theme-light select:focus { border-color: #6366f1 !important; }
    
    /* Light tema kartlar ve paneller */
    .theme-light .bg-emerald-500\/10 { background-color: rgba(16, 185, 129, 0.15) !important; }
    .theme-light .bg-emerald-500\/20 { background-color: rgba(16, 185, 129, 0.2) !important; }
    .theme-light .bg-rose-500\/10 { background-color: rgba(244, 63, 94, 0.15) !important; }
    .theme-light .bg-rose-500\/20 { background-color: rgba(244, 63, 94, 0.2) !important; }
    .theme-light .bg-blue-500\/10 { background-color: rgba(59, 130, 246, 0.15) !important; }
    .theme-light .bg-blue-500\/20 { background-color: rgba(59, 130, 246, 0.2) !important; }
    .theme-light .bg-orange-500\/10 { background-color: rgba(249, 115, 22, 0.15) !important; }
    .theme-light .bg-orange-500\/20 { background-color: rgba(249, 115, 22, 0.2) !important; }
    .theme-light .bg-amber-500\/10 { background-color: rgba(245, 158, 11, 0.15) !important; }
    .theme-light .bg-amber-500\/20 { background-color: rgba(245, 158, 11, 0.2) !important; }
    .theme-light .bg-cyan-500\/10 { background-color: rgba(6, 182, 212, 0.15) !important; }
    .theme-light .bg-cyan-500\/20 { background-color: rgba(6, 182, 212, 0.2) !important; }
    .theme-light .bg-indigo-500\/20 { background-color: rgba(99, 102, 241, 0.2) !important; }
    
    /* Light tema text renkleri - daha koyu */
    .theme-light .text-emerald-400 { color: #059669 !important; }
    .theme-light .text-emerald-300 { color: #10b981 !important; }
    .theme-light .text-rose-400 { color: #e11d48 !important; }
    .theme-light .text-rose-300 { color: #f43f5e !important; }
    .theme-light .text-blue-400 { color: #2563eb !important; }
    .theme-light .text-orange-400 { color: #ea580c !important; }
    .theme-light .text-orange-300 { color: #f97316 !important; }
    .theme-light .text-amber-400 { color: #d97706 !important; }
    .theme-light .text-cyan-400 { color: #0891b2 !important; }
    .theme-light .text-cyan-300 { color: #06b6d4 !important; }
    .theme-light .text-indigo-400 { color: #4f46e5 !important; }
    
    /* Tema uygulama */
    body {
      background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
      color: var(--text-primary);
      transition: background 0.3s ease, color 0.3s ease;
    }
    
    .theme-light input[type="date"]::-webkit-calendar-picker-indicator { filter: none; }
    .theme-light input[type="time"]::-webkit-calendar-picker-indicator { filter: none; }
    
    input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
    input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1); }
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      body { background: white !important; }
      * { color: black !important; background: white !important; border-color: #ccc !important; }
    }
    .print-only { display: none; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-slide-in { animation: slideIn 0.3s ease-out; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    .animate-shake { animation: shake 0.3s ease-out; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .animate-spin { animation: spin 1s linear infinite; }
    
    /* Tema-bazlƒ± renkler i√ßin yardƒ±mcƒ± class'lar */
    .bg-theme-primary { background-color: var(--bg-primary); }
    .bg-theme-secondary { background-color: var(--bg-secondary); }
    .bg-theme-card { background-color: var(--bg-card); }
    .text-theme-primary { color: var(--text-primary); }
    .text-theme-secondary { color: var(--text-secondary); }
    .text-theme-muted { color: var(--text-muted); }
    .border-theme { border-color: var(--border-color); }
  

    /* Mobilde daha sade: animasyon/transition kapat */
    @media (max-width: 768px) {
      * {
        animation: none !important;
        transition: none !important;
      }
    }
</style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ==================== JSONBIN.IO CONFIG ====================
    // Veriler JSONBin.io'da saklanacak - her cihazdan eri≈üilebilir
    const JSONBIN_API_KEY = '$2a$10$CO2lfQPPs8nJz30YLvXo4OIJD/ikX.V2hhW2PaKA9bhsxL0i7r/i2';
    const JSONBIN_BIN_NAME = 'gelir-gider-pro-data';
    
    // ==================== SMART POLLING CONFIG ====================
    const SYNC_INTERVAL = 10000; // 10 saniye
    const SYNC_STATUS = {
      SYNCED: 'synced',      // üü¢ Senkron
      SYNCING: 'syncing',    // üü° Senkronize ediliyor
      PENDING: 'pending',    // üü° Bekliyor
      OFFLINE: 'offline',    // üî¥ Baƒülantƒ± yok
      CONFLICT: 'conflict'   // üü† √áakƒ±≈üma var
    };

    // ==================== ≈ûƒ∞FRE HASH FONKSƒ∞YONU ====================
    const hashPassword = async (password) => {
      const encoder = new TextEncoder();
      const data = encoder.encode(password + 'gelir-gider-pro-salt-2024');
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    };

    // ==================== Gƒ∞Rƒ∞≈û EKRANI ====================
    function LoginScreen({ onLogin, storedUser, onSetUser }) {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [isRegistering, setIsRegistering] = useState(!storedUser);
      const [error, setError] = useState('');
      const [showPassword, setShowPassword] = useState(false);
      const [loading, setLoading] = useState(false);

      const handleRegister = async () => {
        if (!email || !password) {
          setError('Email ve ≈üifre gerekli');
          return;
        }
        if (!email.includes('@')) {
          setError('Ge√ßerli bir email girin');
          return;
        }
        if (password.length < 4) {
          setError('≈ûifre en az 4 karakter olmalƒ±');
          return;
        }
        if (password !== confirmPassword) {
          setError('≈ûifreler e≈üle≈ümiyor');
          return;
        }
        
        setLoading(true);
        const hashedPassword = await hashPassword(password);
        const userData = { email, passwordHash: hashedPassword };
        onSetUser(userData);
        setLoading(false);
        onLogin();
      };

      const handleLogin = async () => {
        if (!password) {
          setError('≈ûifre gerekli');
          return;
        }
        
        setLoading(true);
        const hashedPassword = await hashPassword(password);
        
        if (hashedPassword === storedUser.passwordHash) {
          setLoading(false);
          onLogin();
        } else {
          setLoading(false);
          setError('≈ûifre hatalƒ±');
        }
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        setError('');
        if (isRegistering) {
          handleRegister();
        } else {
          handleLogin();
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex flex-col items-center justify-center p-6">
          <div className="mb-8 text-center">
            <div className="w-20 h-20 bg-indigo-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
              <span className="text-5xl">üí∞</span>
            </div>
            <h1 className="text-white text-2xl font-bold">Gelir-Gider Pro</h1>
            <p className="text-gray-400 mt-2">
              {isRegistering ? 'Hesap Olu≈ütur' : `${storedUser?.email || ''}`}
            </p>
          </div>

          <form onSubmit={handleSubmit} className="w-full max-w-sm space-y-4">
            {isRegistering && (
              <div>
                <label className="text-gray-400 text-sm mb-1 block">Email</label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  placeholder="ornek@email.com"
                  className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 transition-all"
                  autoComplete="email"
                />
              </div>
            )}

            <div>
              <label className="text-gray-400 text-sm mb-1 block">
                {isRegistering ? '≈ûifre (PIN)' : '≈ûifre / PIN'}
              </label>
              <div className="relative">
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 transition-all pr-12"
                  autoComplete={isRegistering ? 'new-password' : 'current-password'}
                  autoFocus={!isRegistering}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors"
                >
                  {showPassword ? 'üôà' : 'üëÅÔ∏è'}
                </button>
              </div>
            </div>

            {isRegistering && (
              <div>
                <label className="text-gray-400 text-sm mb-1 block">≈ûifre Tekrar</label>
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 transition-all"
                  autoComplete="new-password"
                />
              </div>
            )}

            {error && (
              <div className="bg-rose-500/20 border border-rose-500/30 text-rose-400 px-4 py-2 rounded-xl text-sm animate-shake">
                {error}
              </div>
            )}

            <button
              type="submit"
              disabled={loading}
              className="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-xl font-medium transition-all disabled:opacity-50"
            >
              {loading ? 'Bekleyin...' : isRegistering ? 'Hesap Olu≈ütur' : 'Giri≈ü Yap'}
            </button>
          </form>

          {!isRegistering && (
            <button
              onClick={() => {
                if (confirm('≈ûifreyi sƒ±fƒ±rlamak T√úM YERELVERƒ∞LERƒ∞ silecek. Buluttaki veriler korunur. Devam edilsin mi?')) {
                  localStorage.removeItem('app-user');
                  window.location.reload();
                }
              }}
              className="mt-6 text-gray-500 text-sm hover:text-gray-400 transition-colors"
            >
              ≈ûifremi unuttum / Hesabƒ± sƒ±fƒ±rla
            </button>
          )}
        </div>
      );
    }

    // Modal Bile≈üeni
    function Modal({ isOpen, onClose, title, children }) {
      if (!isOpen) return null;
      return (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={onClose}>
          <div className="bg-slate-800 rounded-2xl p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto animate-slide-in" onClick={e => e.stopPropagation()}>
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-white">{title}</h3>
              <button onClick={onClose} className="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            {children}
          </div>
        </div>
      );
    }

    // Toast Bildirimi
    function Toast({ message, type, onClose }) {
      useEffect(() => {
        const timer = setTimeout(onClose, 3000);
        return () => clearTimeout(timer);
      }, [onClose]);

      const colors = {
        success: 'bg-emerald-500',
        error: 'bg-rose-500',
        info: 'bg-blue-500',
        warning: 'bg-amber-500'
      };

      return (
        <div className={`fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-xl shadow-lg z-50 animate-slide-in`}>
          {message}
        </div>
      );
    }

    function GelirGiderApp() {
      // ==================== TEMA STATE'LERƒ∞ ====================
      const [darkMode, setDarkMode] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-dark-mode');
        return saved !== null ? saved === 'true' : true; // Varsayƒ±lan: dark
      });
      const [vividColors, setVividColors] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-vivid-colors');
        return saved === 'true';
      });

      // Tema class'larƒ±nƒ± uygula
      useEffect(() => {
        document.body.classList.toggle('theme-light', !darkMode);
        document.body.classList.toggle('theme-vivid', vividColors);
                document.body.classList.add('theme-clinic');
localStorage.setItem('gelir-gider-dark-mode', darkMode);
        localStorage.setItem('gelir-gider-vivid-colors', vividColors);
      }, [darkMode, vividColors]);

      // JSONBin Sync States
      const [isSyncing, setIsSyncing] = useState(false);
      const [lastSyncTime, setLastSyncTime] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-last-sync');
        return saved ? new Date(saved) : null;
      });
      const [syncEnabled, setSyncEnabled] = useState(() => {
        return localStorage.getItem('gelir-gider-sync-enabled') === 'true';
      });
      const [binId, setBinId] = useState(() => localStorage.getItem('gelir-gider-bin-id'));
      const [showSyncModal, setShowSyncModal] = useState(false);
      
      // ==================== SMART POLLING STATES ====================
      const [syncStatus, setSyncStatus] = useState(SYNC_STATUS.SYNCED);
      const [cloudTimestamp, setCloudTimestamp] = useState(() => localStorage.getItem('gelir-gider-cloud-timestamp'));
      const [localTimestamp, setLocalTimestamp] = useState(() => localStorage.getItem('gelir-gider-local-timestamp') || new Date().toISOString());
      const [hasLocalChanges, setHasLocalChanges] = useState(false);
      const [conflictData, setConflictData] = useState(null);
      const [showConflictModal, setShowConflictModal] = useState(false);
      const syncIntervalRef = useRef(null);
      const isInitialMount = useRef(true);
      
      // State'ler
      const [transactions, setTransactions] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-transactions');
        return saved ? JSON.parse(saved) : [];
      });
      const [reminders, setReminders] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-reminders');
        return saved ? JSON.parse(saved) : [];
      });
      const [cariHesaplar, setCariHesaplar] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-cari');
        return saved ? JSON.parse(saved) : [];
      });
      const [cariIslemler, setCariIslemler] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-cari-islemler');
        return saved ? JSON.parse(saved) : [];
      });
      const [kasalar, setKasalar] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-kasalar');
        if (saved) {
          // Eski verilere isMainKasa ekle (yoksa true yap)
          const parsed = JSON.parse(saved);
          return parsed.map(k => ({ ...k, isMainKasa: k.isMainKasa !== undefined ? k.isMainKasa : true }));
        }
        return [
          { id: 'nakit', name: 'Nakit Kasa', icon: 'üíµ', color: 'emerald', isMainKasa: true },
          { id: 'kredikarti', name: 'Kredi Kartƒ±', icon: 'üí≥', color: 'blue', isMainKasa: true }
        ];
      });
      const [giderKategorileri, setGiderKategorileri] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-gider-kategorileri');
        return saved ? JSON.parse(saved) : ['Firma √ñdemeleri', 'Maa≈ü √ñdemeleri', 'Elektrik', 'Su', 'Mutfak Giderleri'];
      });
      const [gelirKategorileri, setGelirKategorileri] = useState(() => {
        const saved = localStorage.getItem('gelir-gider-gelir-kategorileri');
        return saved ? JSON.parse(saved) : ['Hasta √ñdemeleri', 'Ekstra Gelirler'];
      });
      const [description, setDescription] = useState('');
      const [amount, setAmount] = useState('');
      const [type, setType] = useState('gelir');
      const [category, setCategory] = useState('');
      const [paymentMethod, setPaymentMethod] = useState('nakit');
      const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
      const [note, setNote] = useState('');
      const [filterType, setFilterType] = useState('all');
      const [filterKasa, setFilterKasa] = useState('all');
      const [searchQuery, setSearchQuery] = useState('');
      const [activeTab, setActiveTab] = useState('islemler');
      const [startDate, setStartDate] = useState('');
      const [endDate, setEndDate] = useState('');
      const [ozetViewMode, setOzetViewMode] = useState('today'); // 'today', 'month', 'year', 'custom'
      const [ozetStartDate, setOzetStartDate] = useState('');
      const [ozetEndDate, setOzetEndDate] = useState('');
      const [toast, setToast] = useState(null);
      const [editingTransaction, setEditingTransaction] = useState(null);
      const [showEditModal, setShowEditModal] = useState(false);
      const [showReminderModal, setShowReminderModal] = useState(false);
      const [showTransferModal, setShowTransferModal] = useState(false);
      const [showBackupModal, setShowBackupModal] = useState(false);
      const [showCariModal, setShowCariModal] = useState(false);
      const [showCariIslemModal, setShowCariIslemModal] = useState(false);
      const [showCariDetailModal, setShowCariDetailModal] = useState(false);
      const [showKasaModal, setShowKasaModal] = useState(false);
      const [showGiderKategoriModal, setShowGiderKategoriModal] = useState(false);
      const [showGelirKategoriModal, setShowGelirKategoriModal] = useState(false);
      const [selectedCari, setSelectedCari] = useState(null);
      const [newCari, setNewCari] = useState({ name: '', type: 'firma', phone: '', note: '' });
      const [newCariIslem, setNewCariIslem] = useState({ type: 'borc', amount: '', description: '', vade: '', hatirlatici: false });
      const [newKasaName, setNewKasaName] = useState('');
      const [newKasaIsMain, setNewKasaIsMain] = useState(true);
      const [newGiderKategori, setNewGiderKategori] = useState('');
      const [newGelirKategori, setNewGelirKategori] = useState('');
      const [editingKasa, setEditingKasa] = useState(null);
      const [editingGiderKat, setEditingGiderKat] = useState(null);
      const [editingGelirKat, setEditingGelirKat] = useState(null);
      const [editingCari, setEditingCari] = useState(null);
      const [transferAmount, setTransferAmount] = useState('');
      const [transferFrom, setTransferFrom] = useState('');
      const [transferTo, setTransferTo] = useState('');
      const [transferNote, setTransferNote] = useState('');
      const [newReminder, setNewReminder] = useState({ title: '', amount: '', category: 'gider', day: 1 });
      const [showOdemeModal, setShowOdemeModal] = useState(false);
      const [selectedBorc, setSelectedBorc] = useState(null);
      const [odemeAmount, setOdemeAmount] = useState('');
      const [odemeKasa, setOdemeKasa] = useState('nakit');
      const [odemeNote, setOdemeNote] = useState('');
      const [odemeVade, setOdemeVade] = useState('');
      const [odemeHatirlatici, setOdemeHatirlatici] = useState(false);
      const [odemeHatirlaticiGun, setOdemeHatirlaticiGun] = useState(3);
      const [odemeTekrar, setOdemeTekrar] = useState('tek'); // 'tek' veya 'aylik'
      const [showPlanlaModal, setShowPlanlaModal] = useState(false);
      const chartRef = useRef(null);
      const chartInstance = useRef(null);

      // Verileri localStorage'a kaydet
      useEffect(() => {
        localStorage.setItem('gelir-gider-transactions', JSON.stringify(transactions));
      }, [transactions]);

      useEffect(() => {
        localStorage.setItem('gelir-gider-reminders', JSON.stringify(reminders));
      }, [reminders]);

      useEffect(() => {
        localStorage.setItem('gelir-gider-cari', JSON.stringify(cariHesaplar));
      }, [cariHesaplar]);

      useEffect(() => {
        localStorage.setItem('gelir-gider-cari-islemler', JSON.stringify(cariIslemler));
      }, [cariIslemler]);

      useEffect(() => {
        localStorage.setItem('gelir-gider-kasalar', JSON.stringify(kasalar));
      }, [kasalar]);

      useEffect(() => {
        localStorage.setItem('gelir-gider-gider-kategorileri', JSON.stringify(giderKategorileri));
      }, [giderKategorileri]);

      useEffect(() => {
        localStorage.setItem('gelir-gider-gelir-kategorileri', JSON.stringify(gelirKategorileri));
      }, [gelirKategorileri]);

      // Hatƒ±rlatƒ±cƒ±larƒ± kontrol et
      useEffect(() => {
        const today = new Date().getDate();
        reminders.forEach(reminder => {
          if (reminder.day === today && !reminder.notifiedToday) {
            showToast(`Hatƒ±rlatma: ${reminder.title} - ${formatMoney(reminder.amount)}`, 'warning');
            setReminders(prev => prev.map(r => 
              r.id === reminder.id ? { ...r, notifiedToday: true } : r
            ));
          }
        });
        // Her g√ºn sƒ±fƒ±rla
        const now = new Date();
        if (now.getHours() === 0 && now.getMinutes() === 0) {
          setReminders(prev => prev.map(r => ({ ...r, notifiedToday: false })));
        }
      }, [reminders]);

      // Vade hatƒ±rlatƒ±cƒ±larƒ±nƒ± kontrol et
      useEffect(() => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        cariIslemler.forEach(islem => {
          if (islem.vade && islem.hatirlatici && !islem.vadeBildirimYapildi) {
            const vadeDate = new Date(islem.vade);
            vadeDate.setHours(0, 0, 0, 0);
            const diffDays = Math.ceil((vadeDate - today) / (1000 * 60 * 60 * 24));
            if (diffDays <= 3 && diffDays >= 0) {
              const cari = cariHesaplar.find(c => c.id === islem.cariId);
              const cariName = cari ? cari.name : 'Bilinmeyen';
              showToast(`Vade Hatƒ±rlatma: ${cariName} - ${formatMoney(islem.amount)} (${diffDays === 0 ? 'BUG√úN' : diffDays + ' g√ºn kaldƒ±'})`, 'warning');
              setCariIslemler(prev => prev.map(i => 
                i.id === islem.id ? { ...i, vadeBildirimYapildi: true } : i
              ));
            }
          }
        });
      }, [cariIslemler, cariHesaplar]);

      // Dinamik kategoriler
      const categories = {
        gelir: gelirKategorileri,
        gider: giderKategorileri
      };

      // Kasa ekleme fonksiyonu
      const addKasa = () => {
        if (!newKasaName.trim()) {
          showToast('L√ºtfen kasa adƒ± girin', 'error');
          return;
        }
        const kasaId = newKasaName.trim().toLowerCase().replace(/\s+/g, '_') + '_' + Date.now();
        const colors = ['purple', 'pink', 'amber', 'cyan', 'indigo', 'rose', 'teal'];
        const icons = ['üí∞', 'üè¶', 'üíé', 'ü™ô', 'üì¶', 'üéØ', '‚≠ê'];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        const randomIcon = icons[Math.floor(Math.random() * icons.length)];
        
        const newKasa = {
          id: kasaId,
          name: newKasaName.trim(),
          icon: randomIcon,
          color: randomColor,
          isMainKasa: newKasaIsMain
        };
        setKasalar([...kasalar, newKasa]);
        setNewKasaName('');
        setNewKasaIsMain(true);
        setShowKasaModal(false);
        showToast('Kasa eklendi', 'success');
      };

      // Kasa ana kasa durumunu deƒüi≈ütir
      const toggleKasaMain = (kasaId) => {
        setKasalar(kasalar.map(k => k.id === kasaId ? { ...k, isMainKasa: !k.isMainKasa } : k));
        showToast('Kasa durumu g√ºncellendi', 'success');
      };

      // Kasa silme
      const deleteKasa = (kasaId) => {
        if (kasaId === 'nakit' || kasaId === 'kredikarti') {
          showToast('Varsayƒ±lan kasalar silinemez', 'error');
          return;
        }
        if (confirm('Bu kasayƒ± silmek istediƒüinize emin misiniz?')) {
          setKasalar(kasalar.filter(k => k.id !== kasaId));
          showToast('Kasa silindi', 'info');
        }
      };

      // Gider kategorisi ekleme
      const addGiderKategori = () => {
        if (!newGiderKategori.trim()) {
          showToast('L√ºtfen kategori adƒ± girin', 'error');
          return;
        }
        if (giderKategorileri.includes(newGiderKategori.trim())) {
          showToast('Bu kategori zaten mevcut', 'error');
          return;
        }
        setGiderKategorileri([...giderKategorileri, newGiderKategori.trim()]);
        setNewGiderKategori('');
        setShowGiderKategoriModal(false);
        showToast('Gider kategorisi eklendi', 'success');
      };

      // Gider kategorisi silme
      const deleteGiderKategori = (kategori) => {
        if (confirm(`"${kategori}" kategorisini silmek istediƒüinize emin misiniz?`)) {
          setGiderKategorileri(giderKategorileri.filter(k => k !== kategori));
          showToast('Kategori silindi', 'info');
        }
      };

      // Gider kategorisi d√ºzenleme
      const updateGiderKategori = (oldName, newName) => {
        if (!newName.trim()) return;
        setGiderKategorileri(giderKategorileri.map(k => k === oldName ? newName.trim() : k));
        setEditingGiderKat(null);
        showToast('Kategori g√ºncellendi', 'success');
      };

      // Gelir kategorisi ekleme
      const addGelirKategori = () => {
        if (!newGelirKategori.trim()) {
          showToast('L√ºtfen kategori adƒ± girin', 'error');
          return;
        }
        if (gelirKategorileri.includes(newGelirKategori.trim())) {
          showToast('Bu kategori zaten mevcut', 'error');
          return;
        }
        setGelirKategorileri([...gelirKategorileri, newGelirKategori.trim()]);
        setNewGelirKategori('');
        showToast('Gelir kategorisi eklendi', 'success');
      };

      // Gelir kategorisi silme
      const deleteGelirKategori = (kategori) => {
        if (confirm(`"${kategori}" kategorisini silmek istediƒüinize emin misiniz?`)) {
          setGelirKategorileri(gelirKategorileri.filter(k => k !== kategori));
          showToast('Kategori silindi', 'info');
        }
      };

      // Gelir kategorisi d√ºzenleme
      const updateGelirKategori = (oldName, newName) => {
        if (!newName.trim()) return;
        setGelirKategorileri(gelirKategorileri.map(k => k === oldName ? newName.trim() : k));
        setEditingGelirKat(null);
        showToast('Kategori g√ºncellendi', 'success');
      };

      // Kasa d√ºzenleme
      const updateKasa = (kasaId, newName) => {
        if (!newName.trim()) return;
        setKasalar(kasalar.map(k => k.id === kasaId ? { ...k, name: newName.trim() } : k));
        setEditingKasa(null);
        showToast('Kasa g√ºncellendi', 'success');
      };

      // Cari hesap d√ºzenleme
      const updateCariHesap = () => {
        if (!editingCari || !editingCari.name.trim()) {
          showToast('L√ºtfen cari hesap adƒ± girin', 'error');
          return;
        }
        setCariHesaplar(cariHesaplar.map(c => c.id === editingCari.id ? editingCari : c));
        setEditingCari(null);
        showToast('Cari hesap g√ºncellendi', 'success');
      };

      const showToast = (message, type = 'success') => {
        setToast({ message, type });
      };

      // ==================== JSONBIN SYNC FUNCTIONS (SMART POLLING) ====================
      
      // T√ºm verileri tek objede topla
      const getAllData = useCallback(() => ({
        version: '5.0',
        exportDate: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        transactions,
        reminders,
        cariHesaplar,
        cariIslemler,
        kasalar,
        giderKategorileri,
        gelirKategorileri
      }), [transactions, reminders, cariHesaplar, cariIslemler, kasalar, giderKategorileri, gelirKategorileri]);

      // Verileri kar≈üƒ±la≈ütƒ±r (deƒüi≈üiklik var mƒ±?)
      const hasDataChanged = (localData, cloudData) => {
        if (!cloudData) return true;
        const localStr = JSON.stringify({
          transactions: localData.transactions,
          reminders: localData.reminders,
          cariHesaplar: localData.cariHesaplar,
          cariIslemler: localData.cariIslemler,
          kasalar: localData.kasalar,
          giderKategorileri: localData.giderKategorileri,
          gelirKategorileri: localData.gelirKategorileri
        });
        const cloudStr = JSON.stringify({
          transactions: cloudData.transactions,
          reminders: cloudData.reminders,
          cariHesaplar: cloudData.cariHesaplar,
          cariIslemler: cloudData.cariIslemler,
          kasalar: cloudData.kasalar,
          giderKategorileri: cloudData.giderKategorileri,
          gelirKategorileri: cloudData.gelirKategorileri
        });
        return localStr !== cloudStr;
      };

      // Buluttan veri √ßek (sadece kontrol i√ßin - metadata ile)
      const checkCloudForChanges = async () => {
        const savedBinId = binId || localStorage.getItem('gelir-gider-bin-id');
        if (!savedBinId || !syncEnabled) return null;
        
        try {
          const response = await fetch(`https://api.jsonbin.io/v3/b/${savedBinId}/latest`, {
            headers: { 'X-Master-Key': JSONBIN_API_KEY }
          });
          
          if (!response.ok) {
            setSyncStatus(SYNC_STATUS.OFFLINE);
            return null;
          }
          
          const result = await response.json();
          return result.record;
        } catch (error) {
          console.error('Cloud check error:', error);
          setSyncStatus(SYNC_STATUS.OFFLINE);
          return null;
        }
      };

      // Verileri state'e uygula
      const applyCloudData = (data) => {
        if (data.transactions) setTransactions(data.transactions);
        if (data.reminders) setReminders(data.reminders);
        if (data.cariHesaplar) setCariHesaplar(data.cariHesaplar);
        if (data.cariIslemler) setCariIslemler(data.cariIslemler);
        if (data.kasalar) setKasalar(data.kasalar);
        if (data.giderKategorileri) setGiderKategorileri(data.giderKategorileri);
        if (data.gelirKategorileri) setGelirKategorileri(data.gelirKategorileri);
        
        const now = new Date();
        setLastSyncTime(now);
        setCloudTimestamp(data.lastModified || now.toISOString());
        setLocalTimestamp(data.lastModified || now.toISOString());
        localStorage.setItem('gelir-gider-last-sync', now.toISOString());
        localStorage.setItem('gelir-gider-cloud-timestamp', data.lastModified || now.toISOString());
        localStorage.setItem('gelir-gider-local-timestamp', data.lastModified || now.toISOString());
        setHasLocalChanges(false);
      };

      // JSONBin'e kaydet
      const saveToCloud = async (force = false) => {
        if (!syncEnabled && !force) return false;
        
        const savedBinId = binId || localStorage.getItem('gelir-gider-bin-id');
        if (!savedBinId && !force) return false;
        
        setIsSyncing(true);
        setSyncStatus(SYNC_STATUS.SYNCING);
        
        try {
          const data = getAllData();
          const timestamp = new Date().toISOString();
          data.lastModified = timestamp;
          
          let currentBinId = savedBinId;
          
          if (currentBinId) {
            // Mevcut bin'i g√ºncelle
            const response = await fetch(`https://api.jsonbin.io/v3/b/${currentBinId}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': JSONBIN_API_KEY
              },
              body: JSON.stringify(data)
            });
            
            if (!response.ok) throw new Error('Upload failed');
          } else {
            // Yeni bin olu≈ütur
            const response = await fetch('https://api.jsonbin.io/v3/b', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': JSONBIN_API_KEY,
                'X-Bin-Name': JSONBIN_BIN_NAME
              },
              body: JSON.stringify(data)
            });
            const result = await response.json();
            currentBinId = result.metadata.id;
            setBinId(currentBinId);
            localStorage.setItem('gelir-gider-bin-id', currentBinId);
          }
          
          const now = new Date();
          setLastSyncTime(now);
          setCloudTimestamp(timestamp);
          setLocalTimestamp(timestamp);
          localStorage.setItem('gelir-gider-last-sync', now.toISOString());
          localStorage.setItem('gelir-gider-cloud-timestamp', timestamp);
          localStorage.setItem('gelir-gider-local-timestamp', timestamp);
          setHasLocalChanges(false);
          setSyncStatus(SYNC_STATUS.SYNCED);
          
          return true;
        } catch (error) {
          console.error('Sync error:', error);
          setSyncStatus(SYNC_STATUS.OFFLINE);
          return false;
        } finally {
          setIsSyncing(false);
        }
      };

      // JSONBin'den y√ºkle
      const loadFromCloud = async () => {
        const savedBinId = binId || localStorage.getItem('gelir-gider-bin-id');
        if (!savedBinId) {
          showToast('Hen√ºz bulut verisi yok. √ñnce kaydedin.', 'warning');
          return;
        }
        
        setIsSyncing(true);
        setSyncStatus(SYNC_STATUS.SYNCING);
        
        try {
          const response = await fetch(`https://api.jsonbin.io/v3/b/${savedBinId}/latest`, {
            headers: { 'X-Master-Key': JSONBIN_API_KEY }
          });
          const result = await response.json();
          const data = result.record;
          
          if (data) {
            applyCloudData(data);
            setSyncStatus(SYNC_STATUS.SYNCED);
            showToast('‚òÅÔ∏è Buluttan y√ºklendi!', 'success');
          }
        } catch (error) {
          console.error('Load error:', error);
          setSyncStatus(SYNC_STATUS.OFFLINE);
          showToast('Y√ºkleme hatasƒ±!', 'error');
        }
        setIsSyncing(false);
      };

      // ==================== SMART POLLING - Ana Fonksiyon ====================
      const smartSync = useCallback(async () => {
        if (!syncEnabled || isSyncing) return;
        
        const savedBinId = binId || localStorage.getItem('gelir-gider-bin-id');
        if (!savedBinId) return;
        
        try {
          // 1. Buluttaki veriyi al
          const cloudData = await checkCloudForChanges();
          if (!cloudData) return;
          
          const localData = getAllData();
          const cloudModified = cloudData.lastModified ? new Date(cloudData.lastModified) : new Date(0);
          const localModified = localTimestamp ? new Date(localTimestamp) : new Date(0);
          
          // 2. Kar≈üƒ±la≈ütƒ±r
          const cloudChanged = hasDataChanged(localData, cloudData);
          
          if (!cloudChanged && !hasLocalChanges) {
            // Hi√ßbir deƒüi≈üiklik yok
            setSyncStatus(SYNC_STATUS.SYNCED);
            return;
          }
          
          if (hasLocalChanges && cloudChanged) {
            // √áAKI≈ûMA VAR - Her iki tarafta da deƒüi≈üiklik
            if (cloudModified > localModified) {
              // Bulut daha yeni - √ßakƒ±≈üma uyarƒ±sƒ± g√∂ster
              setConflictData(cloudData);
              setShowConflictModal(true);
              setSyncStatus(SYNC_STATUS.CONFLICT);
              return;
            } else {
              // Lokal daha yeni - buluta g√∂nder
              await saveToCloud();
            }
          } else if (cloudChanged) {
            // Sadece bulutta deƒüi≈üiklik - indir
            applyCloudData(cloudData);
            setSyncStatus(SYNC_STATUS.SYNCED);
            showToast('‚òÅÔ∏è G√ºncelleme alƒ±ndƒ±', 'info');
          } else if (hasLocalChanges) {
            // Sadece lokalde deƒüi≈üiklik - y√ºkle
            await saveToCloud();
            showToast('‚òÅÔ∏è Kaydedildi', 'success');
          }
          
        } catch (error) {
          console.error('Smart sync error:', error);
          setSyncStatus(SYNC_STATUS.OFFLINE);
        }
      }, [syncEnabled, isSyncing, binId, hasLocalChanges, localTimestamp, getAllData]);

      // √áakƒ±≈üma √ß√∂z√ºm√º - Buluttaki veriyi kullan
      const resolveConflictUseCloud = () => {
        if (conflictData) {
          applyCloudData(conflictData);
          setSyncStatus(SYNC_STATUS.SYNCED);
          showToast('‚òÅÔ∏è Buluttaki veri y√ºklendi', 'success');
        }
        setConflictData(null);
        setShowConflictModal(false);
      };

      // √áakƒ±≈üma √ß√∂z√ºm√º - Lokal veriyi kullan
      const resolveConflictUseLocal = async () => {
        setConflictData(null);
        setShowConflictModal(false);
        await saveToCloud(true);
        showToast('‚òÅÔ∏è Yerel veri buluta kaydedildi', 'success');
      };

      // Senkronizasyonu etkinle≈ütir
      const enableSync = async () => {
        setSyncEnabled(true);
        localStorage.setItem('gelir-gider-sync-enabled', 'true');
        const success = await saveToCloud(true);
        if (success) {
          showToast('‚òÅÔ∏è Senkronizasyon aktif!', 'success');
        }
      };

      // Senkronizasyonu devre dƒ±≈üƒ± bƒ±rak
      const disableSync = () => {
        setSyncEnabled(false);
        localStorage.setItem('gelir-gider-sync-enabled', 'false');
        if (syncIntervalRef.current) {
          clearInterval(syncIntervalRef.current);
        }
        setSyncStatus(SYNC_STATUS.OFFLINE);
        showToast('Senkronizasyon kapatƒ±ldƒ±', 'info');
      };

      // Ba≈üka cihazdan veri √ßek (Bin ID ile)
      const importFromBinId = async (importBinId) => {
        if (!importBinId || importBinId.trim() === '') {
          showToast('L√ºtfen Bin ID girin', 'error');
          return;
        }
        
        setIsSyncing(true);
        setSyncStatus(SYNC_STATUS.SYNCING);
        
        try {
          const response = await fetch(`https://api.jsonbin.io/v3/b/${importBinId.trim()}/latest`, {
            headers: { 'X-Master-Key': JSONBIN_API_KEY }
          });
          
          if (!response.ok) throw new Error('Ge√ßersiz Bin ID');
          
          const result = await response.json();
          const data = result.record;
          
          if (data) {
            applyCloudData(data);
            setBinId(importBinId.trim());
            localStorage.setItem('gelir-gider-bin-id', importBinId.trim());
            setSyncEnabled(true);
            localStorage.setItem('gelir-gider-sync-enabled', 'true');
            setSyncStatus(SYNC_STATUS.SYNCED);
            showToast('‚òÅÔ∏è Veriler ba≈üarƒ±yla y√ºklendi!', 'success');
          }
        } catch (error) {
          console.error('Import error:', error);
          setSyncStatus(SYNC_STATUS.OFFLINE);
          showToast('Ge√ßersiz Bin ID veya y√ºkleme hatasƒ±!', 'error');
        }
        setIsSyncing(false);
      };

      // ==================== SMART POLLING - Interval ====================
      useEffect(() => {
        if (syncEnabled && binId) {
          // Her 10 saniyede bir kontrol et
          syncIntervalRef.current = setInterval(() => {
            smartSync();
          }, SYNC_INTERVAL);
          
          return () => {
            if (syncIntervalRef.current) {
              clearInterval(syncIntervalRef.current);
            }
          };
        }
      }, [syncEnabled, binId, smartSync]);

      // Veri deƒüi≈üikliƒüini izle
      useEffect(() => {
        if (isInitialMount.current) {
          isInitialMount.current = false;
          return;
        }
        
        if (syncEnabled) {
          setHasLocalChanges(true);
          setLocalTimestamp(new Date().toISOString());
          localStorage.setItem('gelir-gider-local-timestamp', new Date().toISOString());
          setSyncStatus(SYNC_STATUS.PENDING);
        }
      }, [transactions, cariHesaplar, cariIslemler, kasalar, giderKategorileri, gelirKategorileri, reminders]);

      // Veri deƒüi≈ütiƒüinde 3 saniye sonra otomatik kaydet
      useEffect(() => {
        if (!syncEnabled || !hasLocalChanges) return;
        
        const timer = setTimeout(() => {
          saveToCloud();
        }, 3000);
        
        return () => clearTimeout(timer);
      }, [hasLocalChanges, syncEnabled]);

      // ==================== UYGULAMA A√áILDIƒûINDA OTOMATƒ∞K BULUTTAN Y√úKLE ====================
      const [autoSyncDone, setAutoSyncDone] = useState(false);
      
      useEffect(() => {
        const savedBinId = localStorage.getItem('gelir-gider-bin-id');
        const isSyncEnabled = localStorage.getItem('gelir-gider-sync-enabled') === 'true';
        
        if (savedBinId && isSyncEnabled && !autoSyncDone) {
          setAutoSyncDone(true);
          setSyncStatus(SYNC_STATUS.SYNCING);
          
          (async () => {
            setIsSyncing(true);
            try {
              const response = await fetch(`https://api.jsonbin.io/v3/b/${savedBinId}/latest`, {
                headers: { 'X-Master-Key': JSONBIN_API_KEY }
              });
              const result = await response.json();
              const data = result.record;
              
              if (data) {
                applyCloudData(data);
                setSyncStatus(SYNC_STATUS.SYNCED);
                showToast('‚òÅÔ∏è Buluttan g√ºncellendi!', 'success');
              }
            } catch (error) {
              console.error('Auto-sync error:', error);
              setSyncStatus(SYNC_STATUS.OFFLINE);
              showToast('Bulut baƒülantƒ±sƒ± ba≈üarƒ±sƒ±z', 'error');
            }
            setIsSyncing(false);
          })();
        }
      }, []);

      // ==================== END JSONBIN SYNC FUNCTIONS ====================

      const formatMoney = (num) => {
        return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(num);
      };

      const formatDateTR = (dateStr) => {
        if (dateStr.includes('.')) return dateStr;
        const [year, month, day] = dateStr.split('-');
        return `${day}.${month}.${year}`;
      };

      const parseDateTR = (dateStr) => {
        if (!dateStr.includes('.')) return dateStr;
        const [day, month, year] = dateStr.split('.');
        return `${year}-${month}-${day}`;
      };

      const getTodayString = () => {
        const d = new Date();
        const day = String(d.getDate()).padStart(2, '0');
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const year = d.getFullYear();
        return `${day}.${month}.${year}`;
      };

      const isToday = (dateStr) => {
        if (!dateStr) return false;
        return dateStr === getTodayString();
      };

      const isThisMonth = (dateStr) => {
        if (!dateStr || !dateStr.includes('.')) return false;
        const parts = dateStr.split('.');
        if (parts.length !== 3) return false;
        const today = new Date();
        const [day, month, year] = parts.map(Number);
        if (isNaN(month) || isNaN(year)) return false;
        return month === (today.getMonth() + 1) && year === today.getFullYear();
      };

      const isInDateRange = (dateStr, start, end) => {
        if (!start && !end) return true;
        if (!dateStr || !dateStr.includes('.')) return false;
        
        const parts = dateStr.split('.');
        if (parts.length !== 3) return false;
        
        const [day, month, year] = parts.map(Number);
        if (isNaN(day) || isNaN(month) || isNaN(year)) return false;
        
        const date = new Date(year, month - 1, day, 12, 0, 0);
        
        if (start && end) {
          const [sYear, sMonth, sDay] = start.split('-').map(Number);
          const [eYear, eMonth, eDay] = end.split('-').map(Number);
          const startD = new Date(sYear, sMonth - 1, sDay, 0, 0, 0);
          const endD = new Date(eYear, eMonth - 1, eDay, 23, 59, 59);
          return date >= startD && date <= endD;
        } else if (start) {
          const [sYear, sMonth, sDay] = start.split('-').map(Number);
          const startD = new Date(sYear, sMonth - 1, sDay, 0, 0, 0);
          return date >= startD;
        } else if (end) {
          const [eYear, eMonth, eDay] = end.split('-').map(Number);
          const endD = new Date(eYear, eMonth - 1, eDay, 23, 59, 59);
          return date <= endD;
        }
        return true;
      };

      // ƒ∞≈ülem Ekleme
      const addTransaction = () => {
        if (!description.trim() || !amount || !category) {
          showToast('L√ºtfen t√ºm alanlarƒ± doldurun', 'error');
          return;
        }
        
        const newTransaction = {
          id: Date.now(),
          description: description.trim(),
          amount: parseFloat(amount),
          type,
          category,
          paymentMethod: paymentMethod,
          date: formatDateTR(selectedDate),
          note: note.trim(),
          createdAt: new Date().toISOString()
        };
        
        setTransactions([newTransaction, ...transactions]);
        setDescription('');
        setAmount('');
        setCategory('');
        setNote('');
        setSelectedDate(new Date().toISOString().split('T')[0]);
        showToast('ƒ∞≈ülem ba≈üarƒ±yla eklendi', 'success');
      };

      // ƒ∞≈ülem Silme
      const deleteTransaction = (id) => {
        if (confirm('Bu i≈ülemi silmek istediƒüinize emin misiniz?')) {
          setTransactions(transactions.filter(t => t.id !== id));
          showToast('ƒ∞≈ülem silindi', 'info');
        }
      };

      // ƒ∞≈ülem D√ºzenleme
      const startEdit = (transaction) => {
        setEditingTransaction({ 
          ...transaction, 
          date: parseDateTR(transaction.date)
        });
        setShowEditModal(true);
      };

      const saveEdit = () => {
        if (!editingTransaction.description || !editingTransaction.amount) {
          showToast('L√ºtfen t√ºm alanlarƒ± doldurun', 'error');
          return;
        }
        setTransactions(transactions.map(t => 
          t.id === editingTransaction.id 
            ? { ...editingTransaction, date: formatDateTR(editingTransaction.date), amount: parseFloat(editingTransaction.amount) }
            : t
        ));
        setShowEditModal(false);
        setEditingTransaction(null);
        showToast('ƒ∞≈ülem g√ºncellendi', 'success');
      };

      // Kasalar Arasƒ± Transfer
      const handleTransfer = () => {
        if (!transferAmount || parseFloat(transferAmount) <= 0) {
          showToast('Ge√ßerli bir tutar girin', 'error');
          return;
        }
        if (!transferFrom || !transferTo) {
          showToast('Kaynak ve hedef kasa se√ßin', 'error');
          return;
        }
        if (transferFrom === transferTo) {
          showToast('Aynƒ± kasaya transfer yapƒ±lamaz', 'error');
          return;
        }
        
        const amt = parseFloat(transferAmount);
        const fromKasa = kasalar.find(k => k.id === transferFrom);
        const toKasa = kasalar.find(k => k.id === transferTo);
        
        if (!fromKasa || !toKasa) {
          showToast('Kasa bulunamadƒ±', 'error');
          return;
        }
        
        // √áƒ±kƒ±≈ü i≈ülemi
        const outTransaction = {
          id: Date.now(),
          description: `Transfer: ${fromKasa.name} ‚Üí ${toKasa.name}`,
          amount: amt,
          type: 'transfer-out',
          category: 'Transfer',
          paymentMethod: transferFrom,
          date: getTodayString(),
          note: transferNote,
          createdAt: new Date().toISOString()
        };
        
        // Giri≈ü i≈ülemi
        const inTransaction = {
          id: Date.now() + 1,
          description: `Transfer: ${fromKasa.name} ‚Üí ${toKasa.name}`,
          amount: amt,
          type: 'transfer-in',
          category: 'Transfer',
          paymentMethod: transferTo,
          date: getTodayString(),
          note: transferNote,
          createdAt: new Date().toISOString()
        };
        
        setTransactions([inTransaction, outTransaction, ...transactions]);
        setTransferAmount('');
        setTransferFrom('');
        setTransferTo('');
        setTransferNote('');
        setShowTransferModal(false);
        showToast('Transfer tamamlandƒ±', 'success');
      };

      // Hatƒ±rlatƒ±cƒ± Ekleme
      const addReminder = () => {
        if (!newReminder.title || !newReminder.amount) {
          showToast('L√ºtfen t√ºm alanlarƒ± doldurun', 'error');
          return;
        }
        const reminder = {
          id: Date.now(),
          ...newReminder,
          amount: parseFloat(newReminder.amount),
          notifiedToday: false
        };
        setReminders([...reminders, reminder]);
        setNewReminder({ title: '', amount: '', category: 'gider', day: 1 });
        showToast('Hatƒ±rlatƒ±cƒ± eklendi', 'success');
      };

      const deleteReminder = (id) => {
        setReminders(reminders.filter(r => r.id !== id));
        showToast('Hatƒ±rlatƒ±cƒ± silindi', 'info');
      };

      // ==================== CARƒ∞ HESAP FONKSƒ∞YONLARI ====================
      
      // Yeni Cari Hesap Ekle
      const addCariHesap = () => {
        if (!newCari.name.trim()) {
          showToast('L√ºtfen cari hesap adƒ± girin', 'error');
          return;
        }
        const cari = {
          id: Date.now(),
          name: newCari.name.trim(),
          type: newCari.type,
          phone: newCari.phone.trim(),
          note: newCari.note.trim(),
          createdAt: new Date().toISOString()
        };
        setCariHesaplar([...cariHesaplar, cari]);
        setNewCari({ name: '', type: 'firma', phone: '', note: '' });
        setShowCariModal(false);
        showToast('Cari hesap eklendi', 'success');
      };

      // Cari Hesap Sil
      const deleteCariHesap = (id) => {
        if (confirm('Bu cari hesabƒ± ve t√ºm i≈ülemlerini silmek istediƒüinize emin misiniz?')) {
          setCariHesaplar(cariHesaplar.filter(c => c.id !== id));
          setCariIslemler(cariIslemler.filter(i => i.cariId !== id));
          setShowCariDetailModal(false);
          showToast('Cari hesap silindi', 'info');
        }
      };

      // Cari ƒ∞≈ülem Ekle (Bor√ß/Alacak)
      const addCariIslem = () => {
        if (!newCariIslem.amount || !selectedCari) {
          showToast('L√ºtfen tutar girin', 'error');
          return;
        }
        const islem = {
          id: Date.now(),
          cariId: selectedCari.id,
          type: newCariIslem.type, // 'borc' veya 'alacak' veya 'odeme'
          amount: parseFloat(newCariIslem.amount),
          description: newCariIslem.description.trim(),
          vade: newCariIslem.vade || null,
          hatirlatici: newCariIslem.hatirlatici,
          vadeBildirimYapildi: false,
          date: formatDateTR(new Date().toISOString().split('T')[0]),
          createdAt: new Date().toISOString()
        };
        setCariIslemler([islem, ...cariIslemler]);
        
        // Vade varsa ve hatƒ±rlatƒ±cƒ± se√ßildiyse otomatik hatƒ±rlatƒ±cƒ± ekle
        if (newCariIslem.vade && newCariIslem.hatirlatici) {
          const vadeDate = new Date(newCariIslem.vade);
          // 3 g√ºn √∂ncesi i√ßin hatƒ±rlatƒ±cƒ±
          const reminderDate = new Date(vadeDate);
          reminderDate.setDate(reminderDate.getDate() - 3);
          const reminderDay = reminderDate.getDate();
          
          const typeLabel = newCariIslem.type === 'alacak' ? 'Alacak' : newCariIslem.type === 'borc' ? 'Bor√ß' : '√ñdeme';
          const reminder = {
            id: Date.now() + 1,
            title: `üìÖ Vade: ${selectedCari.name} - ${typeLabel}`,
            amount: parseFloat(newCariIslem.amount),
            category: newCariIslem.type === 'alacak' ? 'gelir' : 'gider',
            day: reminderDay,
            notifiedToday: false,
            isVadeReminder: true,
            vadeDate: newCariIslem.vade,
            cariId: selectedCari.id
          };
          setReminders(prev => [...prev, reminder]);
          showToast(`ƒ∞≈ülem eklendi + Hatƒ±rlatƒ±cƒ±: Her ayƒ±n ${reminderDay}. g√ºn√º`, 'success');
        } else {
          showToast('ƒ∞≈ülem eklendi', 'success');
        }
        
        setNewCariIslem({ type: 'borc', amount: '', description: '', vade: '', hatirlatici: false });
        setShowCariIslemModal(false);
      };

      // Cari ƒ∞≈ülem Sil
      const deleteCariIslem = (id) => {
        if (confirm('Bu i≈ülemi silmek istediƒüinize emin misiniz?')) {
          setCariIslemler(cariIslemler.filter(i => i.id !== id));
          showToast('ƒ∞≈ülem silindi', 'info');
        }
      };

      // ==================== GELƒ∞≈ûMƒ∞≈û √ñDEME FONKSƒ∞YONLARI ====================
      
      // Bor√ß √∂demesi ba≈ülat (≈üimdi √∂de)
      const startOdeme = (borc) => {
        setSelectedBorc(borc);
        setOdemeAmount(borc.kalanBorc?.toString() || borc.amount.toString());
        setOdemeKasa('nakit');
        setOdemeNote('');
        setOdemeVade('');
        setOdemeHatirlatici(false);
        setShowOdemeModal(true);
      };

      // √ñdeme planla (vade ile)
      const startOdemePlanla = (borc) => {
        setSelectedBorc(borc);
        setOdemeAmount('');
        setOdemeKasa('nakit');
        setOdemeNote('');
        setOdemeVade('');
        setOdemeHatirlatici(true);
        setOdemeHatirlaticiGun(3);
        setOdemeTekrar('tek');
        setShowPlanlaModal(true);
      };

      // √ñdeme yap (kƒ±smi veya tam - ≈üimdi)
      const makeOdeme = () => {
        if (!odemeAmount || parseFloat(odemeAmount) <= 0) {
          showToast('Ge√ßerli bir tutar girin', 'error');
          return;
        }

        const amount = parseFloat(odemeAmount);
        const kalanBorc = selectedBorc.kalanBorc || selectedBorc.amount;
        
        if (amount > kalanBorc) {
          showToast('√ñdeme tutarƒ± bor√ßtan fazla olamaz', 'error');
          return;
        }

        // √ñdeme i≈ülemi olu≈ütur
        const odemeIslem = {
          id: Date.now(),
          cariId: selectedBorc.cariId,
          type: 'odeme',
          amount: amount,
          description: odemeNote || `${selectedBorc.description || 'Bor√ß'} √∂demesi`,
          borcId: selectedBorc.id,
          date: formatDateTR(new Date().toISOString().split('T')[0]),
          createdAt: new Date().toISOString()
        };
        
        setCariIslemler(prev => [odemeIslem, ...prev]);

        // Ana i≈ülemlere gider olarak ekle
        const giderIslem = {
          id: Date.now() + 1,
          description: `${cariHesaplar.find(c => c.id === selectedBorc.cariId)?.name || 'Cari'} - ${odemeNote || 'Bor√ß √ñdemesi'}`,
          amount: amount,
          type: 'gider',
          category: 'Firma √ñdemeleri',
          paymentMethod: odemeKasa,
          date: formatDateTR(new Date().toISOString().split('T')[0]),
          note: `Cari bor√ß √∂demesi`,
          createdAt: new Date().toISOString()
        };
        setTransactions(prev => [giderIslem, ...prev]);

        // Bor√ß kaydƒ±nƒ± g√ºncelle (kalan borcu hesapla)
        const yeniKalan = kalanBorc - amount;
        setCariIslemler(prev => prev.map(i => {
          if (i.id === selectedBorc.id) {
            return { 
              ...i, 
              kalanBorc: yeniKalan,
              tamamenOdendi: yeniKalan <= 0
            };
          }
          return i;
        }));

        // Bor√ß tamamen √∂dendiyse, bu borca ait hatƒ±rlatƒ±cƒ±larƒ± sil
        if (yeniKalan <= 0) {
          // Bu borca baƒülƒ± planlƒ± √∂demelerin hatƒ±rlatƒ±cƒ±larƒ±nƒ± sil
          const planliOdemeler = cariIslemler.filter(i => i.borcId === selectedBorc.id && i.type === 'planli-odeme');
          planliOdemeler.forEach(po => {
            setReminders(prev => prev.filter(r => !(r.vadeDate === po.vade && r.amount === po.amount)));
          });
        }

        setShowOdemeModal(false);
        setSelectedBorc(null);
        showToast(`${formatMoney(amount)} √∂deme yapƒ±ldƒ±`, 'success');
      };

      // √ñdeme planla (vadeli)
      const planlaOdeme = () => {
        if (!odemeAmount || parseFloat(odemeAmount) <= 0) {
          showToast('Ge√ßerli bir tutar girin', 'error');
          return;
        }
        if (!odemeVade) {
          showToast('Vade tarihi se√ßin', 'error');
          return;
        }

        const amount = parseFloat(odemeAmount);
        const kalanBorc = selectedBorc.kalanBorc || selectedBorc.amount;
        
        if (odemeTekrar === 'tek' && amount > kalanBorc) {
          showToast('√ñdeme tutarƒ± bor√ßtan fazla olamaz', 'error');
          return;
        }

        // Planlanan √∂deme kaydƒ±
        const planliOdeme = {
          id: Date.now(),
          cariId: selectedBorc.cariId,
          type: 'planli-odeme',
          amount: amount,
          description: odemeNote || `Planlƒ± √∂deme`,
          borcId: selectedBorc.id,
          vade: odemeVade,
          hatirlatici: odemeHatirlatici,
          tekrar: odemeTekrar, // 'tek' veya 'aylik'
          vadeBildirimYapildi: false,
          tamamlandi: false,
          date: formatDateTR(new Date().toISOString().split('T')[0]),
          createdAt: new Date().toISOString()
        };
        
        setCariIslemler(prev => [planliOdeme, ...prev]);

        // Hatƒ±rlatƒ±cƒ± ekle (se√ßilen g√ºn √∂nce)
        if (odemeHatirlatici) {
          const vadeDate = new Date(odemeVade);
          const reminderDate = new Date(vadeDate);
          reminderDate.setDate(reminderDate.getDate() - odemeHatirlaticiGun);
          
          const reminder = {
            id: Date.now() + 1,
            title: `üìÖ √ñdeme: ${cariHesaplar.find(c => c.id === selectedBorc.cariId)?.name || 'Cari'}`,
            amount: amount,
            category: 'gider',
            day: reminderDate.getDate(),
            notifiedToday: false,
            vadeDate: odemeVade,
            tekrar: odemeTekrar,
            hatirlaticiGun: odemeHatirlaticiGun
          };
          setReminders(prev => [...prev, reminder]);
        }

        setShowPlanlaModal(false);
        setSelectedBorc(null);
        const tekrarText = odemeTekrar === 'aylik' ? ' (Her ay tekrarlanacak)' : ' (Tek seferlik)';
        showToast(`${formatMoney(amount)} √∂deme planlandƒ± - Vade: ${formatDateTR(odemeVade)}${tekrarText}`, 'success');
      };

      // Planlƒ± √∂demeyi tamamla
      const tamamlaPlanliOdeme = (planliOdeme) => {
        // Ana borcun kalanƒ±nƒ± g√ºncelle
        setCariIslemler(prev => prev.map(i => {
          if (i.id === planliOdeme.borcId) {
            const yeniKalan = (i.kalanBorc || i.amount) - planliOdeme.amount;
            return { ...i, kalanBorc: yeniKalan, tamamenOdendi: yeniKalan <= 0 };
          }
          if (i.id === planliOdeme.id) {
            return { ...i, tamamlandi: true, type: 'odeme' };
          }
          return i;
        }));

        // ƒ∞lgili hatƒ±rlatƒ±cƒ±yƒ± sil (vadeDate e≈üle≈üen)
        setReminders(prev => prev.filter(r => 
          !(r.vadeDate === planliOdeme.vade && r.amount === planliOdeme.amount)
        ));

        // Gider kaydƒ± ekle
        const giderIslem = {
          id: Date.now(),
          description: `${cariHesaplar.find(c => c.id === planliOdeme.cariId)?.name || 'Cari'} - Planlƒ± √ñdeme`,
          amount: planliOdeme.amount,
          type: 'gider',
          category: 'Firma √ñdemeleri',
          paymentMethod: 'nakit',
          date: formatDateTR(new Date().toISOString().split('T')[0]),
          note: planliOdeme.description,
          createdAt: new Date().toISOString()
        };
        setTransactions(prev => [giderIslem, ...prev]);

        showToast(`${formatMoney(planliOdeme.amount)} √∂deme tamamlandƒ±`, 'success');
      };

      // Planlƒ± √∂demeleri getir
      const getPlanliOdemeler = (cariId) => {
        return cariIslemler.filter(i => 
          i.cariId === cariId && 
          i.type === 'planli-odeme' && 
          !i.tamamlandi
        ).sort((a, b) => new Date(a.vade) - new Date(b.vade));
      };

      // Cari hesabƒ±n √∂denmemi≈ü bor√ßlarƒ±nƒ± getir
      const getOdenmemisBorclar = (cariId) => {
        return cariIslemler
          .filter(i => i.cariId === cariId && i.type === 'borc' && !i.tamamenOdendi)
          .map(borc => {
            // Bu borca yapƒ±lan √∂demeleri hesapla
            const odemeler = cariIslemler
              .filter(i => i.borcId === borc.id && i.type === 'odeme')
              .reduce((sum, i) => sum + i.amount, 0);
            const kalanBorc = (borc.kalanBorc !== undefined ? borc.kalanBorc : borc.amount);
            return { ...borc, kalanBorc, toplamOdenen: odemeler };
          })
          .filter(b => b.kalanBorc > 0);
      };

      // Toplam kalan bor√ß
      const getToplamKalanBorc = (cariId) => {
        return getOdenmemisBorclar(cariId).reduce((sum, b) => sum + b.kalanBorc, 0);
      };

      // Cari Hesap Bakiye Hesapla
      const getCariBalance = (cariId) => {
        const islemler = cariIslemler.filter(i => i.cariId === cariId);
        let alacak = 0;
        let borc = 0;
        islemler.forEach(i => {
          if (i.type === 'alacak') alacak += i.amount;
          else if (i.type === 'borc') borc += i.amount;
          else if (i.type === 'odeme') borc -= i.amount; // √ñdeme bor√ßtan d√º≈üer
        });
        return { alacak, borc, bakiye: alacak - borc };
      };

      // Toplam Cari Bakiyeler
      const totalCariAlacak = cariHesaplar.reduce((sum, c) => sum + getCariBalance(c.id).alacak, 0);
      const totalCariBorc = cariHesaplar.reduce((sum, c) => sum + Math.abs(Math.min(0, getCariBalance(c.id).bakiye)), 0);
      const totalCariBakiye = cariHesaplar.reduce((sum, c) => sum + getCariBalance(c.id).bakiye, 0);

      // Yakla≈üan Vadeler
      const getYaklasanVadeler = () => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        return cariIslemler
          .filter(i => i.vade && !i.tamamenOdendi && !i.tamamlandi)
          .map(i => {
            const vadeDate = new Date(i.vade);
            vadeDate.setHours(0, 0, 0, 0);
            const diffDays = Math.ceil((vadeDate - today) / (1000 * 60 * 60 * 24));
            const cari = cariHesaplar.find(c => c.id === i.cariId);
            return { ...i, cariName: cari?.name || 'Bilinmeyen', diffDays };
          })
          .filter(i => i.diffDays >= 0 && i.diffDays <= 30)
          .sort((a, b) => a.diffDays - b.diffDays);
      };

      // Excel'e Aktar
      const exportToExcel = () => {
        const data = transactions.map(t => ({
          'Tarih': t.date,
          'T√ºr': t.type === 'gelir' ? 'Gelir' : t.type === 'gider' ? 'Gider' : 'Transfer',
          'Kategori': t.category,
          'A√ßƒ±klama': t.description,
          'Tutar': t.amount,
          'Kasa': t.paymentMethod === 'nakit' ? 'Nakit' : t.paymentMethod === 'kredikarti' ? 'Kredi Kartƒ±' : '-',
          'Not': t.note || ''
        }));
        
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'ƒ∞≈ülemler');
        
        // √ñzet sayfasƒ±
        const summary = [
          { 'A√ßƒ±klama': 'Toplam Gelir', 'Tutar': totalIncome },
          { 'A√ßƒ±klama': 'Toplam Gider', 'Tutar': totalExpense },
          { 'A√ßƒ±klama': 'Net Bakiye', 'Tutar': balance },
          { 'A√ßƒ±klama': 'Nakit Kasa', 'Tutar': nakitKasa },
          { 'A√ßƒ±klama': 'Kredi Kartƒ± Kasasƒ±', 'Tutar': krediKartiKasa }
        ];
        const ws2 = XLSX.utils.json_to_sheet(summary);
        XLSX.utils.book_append_sheet(wb, ws2, '√ñzet');
        
        XLSX.writeFile(wb, `gelir-gider-${new Date().toISOString().split('T')[0]}.xlsx`);
        showToast('Excel dosyasƒ± indirildi', 'success');
      };

      // Yedekleme
      const backupData = () => {
        const data = {
          transactions,
          reminders,
          cariHesaplar,
          cariIslemler,
          kasalar,
          giderKategorileri,
          gelirKategorileri,
          exportDate: new Date().toISOString(),
          version: '4.0'
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `gelir-gider-yedek-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        showToast('Yedek dosyasƒ± indirildi', 'success');
      };

      const restoreData = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (data.transactions) {
              if (confirm(`${data.transactions.length} i≈ülem, ${data.cariHesaplar?.length || 0} cari hesap, ${data.kasalar?.length || 0} kasa geri y√ºklenecek. Mevcut veriler silinecek. Devam edilsin mi?`)) {
                setTransactions(data.transactions);
                setReminders(data.reminders || []);
                setCariHesaplar(data.cariHesaplar || []);
                setCariIslemler(data.cariIslemler || []);
                if (data.kasalar) setKasalar(data.kasalar);
                if (data.giderKategorileri) setGiderKategorileri(data.giderKategorileri);
                if (data.gelirKategorileri) setGelirKategorileri(data.gelirKategorileri);
                showToast('Veriler ba≈üarƒ±yla geri y√ºklendi', 'success');
              }
            } else {
              showToast('Ge√ßersiz yedek dosyasƒ±', 'error');
            }
          } catch (err) {
            showToast('Dosya okunamadƒ±', 'error');
          }
        };
        reader.readAsText(file);
        event.target.value = '';
      };

      // Yazdƒ±rma
      const printReport = () => {
        window.print();
      };

      // Hesaplamalar
      const calculateKasa = (method) => {
        let total = 0;
        transactions.forEach(t => {
          if (t.paymentMethod === method) {
            if (t.type === 'gelir') total += t.amount;
            else if (t.type === 'gider') total -= t.amount;
            else if (t.type === 'transfer-out') total -= t.amount;
            else if (t.type === 'transfer-in') total += t.amount;
          }
        });
        return total;
      };

      // T√ºm kasalarƒ±n bakiyelerini hesapla
      const kasaBakiyeleri = kasalar.reduce((acc, kasa) => {
        acc[kasa.id] = calculateKasa(kasa.id);
        return acc;
      }, {});

      const nakitKasa = kasaBakiyeleri['nakit'] || 0;
      const krediKartiKasa = kasaBakiyeleri['kredikarti'] || 0;
      
      // Sadece ana kasalarƒ±n toplamƒ±
      const toplamKasaBakiye = kasalar
        .filter(k => k.isMainKasa !== false)
        .reduce((sum, kasa) => sum + (kasaBakiyeleri[kasa.id] || 0), 0);
      
      // Harici kasalarƒ±n toplamƒ± (ana kasaya dahil olmayanlar)
      const hariciKasaBakiye = kasalar
        .filter(k => k.isMainKasa === false)
        .reduce((sum, kasa) => sum + (kasaBakiyeleri[kasa.id] || 0), 0);

      const totalIncome = transactions
        .filter(t => t.type === 'gelir')
        .reduce((sum, t) => sum + t.amount, 0);

      const totalExpense = transactions
        .filter(t => t.type === 'gider')
        .reduce((sum, t) => sum + t.amount, 0);

      const balance = totalIncome - totalExpense;

      // Filtrelenmi≈ü i≈ülemler
      const filteredTransactions = transactions.filter(t => {
        const typeMatch = filterType === 'all' || t.type === filterType || 
          (filterType === 'transfer' && (t.type === 'transfer-in' || t.type === 'transfer-out'));
        const kasaMatch = filterKasa === 'all' || t.paymentMethod === filterKasa;
        const searchMatch = !searchQuery || 
          t.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
          t.category.toLowerCase().includes(searchQuery.toLowerCase()) ||
          (t.note && t.note.toLowerCase().includes(searchQuery.toLowerCase()));
        return typeMatch && kasaMatch && searchMatch;
      });

      // ƒ∞statistikler
      const todayTransactions = transactions.filter(t => isToday(t.date));
      const todayIncome = todayTransactions.filter(t => t.type === 'gelir').reduce((s, t) => s + t.amount, 0);
      const todayExpense = todayTransactions.filter(t => t.type === 'gider').reduce((s, t) => s + t.amount, 0);

      const monthTransactions = transactions.filter(t => isThisMonth(t.date));
      const monthIncome = monthTransactions.filter(t => t.type === 'gelir').reduce((s, t) => s + t.amount, 0);
      const monthExpense = monthTransactions.filter(t => t.type === 'gider').reduce((s, t) => s + t.amount, 0);
      const monthIncomeNakit = monthTransactions.filter(t => t.type === 'gelir' && t.paymentMethod === 'nakit').reduce((s, t) => s + t.amount, 0);
      const monthIncomeKrediKarti = monthTransactions.filter(t => t.type === 'gelir' && t.paymentMethod === 'kredikarti').reduce((s, t) => s + t.amount, 0);

      const rangeTransactions = transactions.filter(t => isInDateRange(t.date, startDate, endDate));
      const rangeIncome = rangeTransactions.filter(t => t.type === 'gelir').reduce((s, t) => s + t.amount, 0);
      const rangeExpense = rangeTransactions.filter(t => t.type === 'gider').reduce((s, t) => s + t.amount, 0);
      const rangeIncomeNakit = rangeTransactions.filter(t => t.type === 'gelir' && t.paymentMethod === 'nakit').reduce((s, t) => s + t.amount, 0);
      const rangeIncomeKrediKarti = rangeTransactions.filter(t => t.type === 'gelir' && t.paymentMethod === 'kredikarti').reduce((s, t) => s + t.amount, 0);

      const monthExpenseByCategory = categories.gider.map(cat => ({
        category: cat,
        amount: monthTransactions.filter(t => t.type === 'gider' && t.category === cat).reduce((s, t) => s + t.amount, 0)
      })).filter(c => c.amount > 0);

      // Grafik
      useEffect(() => {
        if (activeTab === 'grafikler' && chartRef.current) {
          if (chartInstance.current) {
            chartInstance.current.destroy();
          }

          const last6Months = [];
          const now = new Date();
          for (let i = 5; i >= 0; i--) {
            const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
            last6Months.push({
              month: d.getMonth() + 1,
              year: d.getFullYear(),
              label: d.toLocaleDateString('tr-TR', { month: 'short', year: '2-digit' })
            });
          }

          const incomeData = last6Months.map(m => {
            return transactions
              .filter(t => {
                const [d, mo, y] = t.date.split('.').map(Number);
                return t.type === 'gelir' && mo === m.month && y === m.year;
              })
              .reduce((s, t) => s + t.amount, 0);
          });

          const expenseData = last6Months.map(m => {
            return transactions
              .filter(t => {
                const [d, mo, y] = t.date.split('.').map(Number);
                return t.type === 'gider' && mo === m.month && y === m.year;
              })
              .reduce((s, t) => s + t.amount, 0);
          });

          chartInstance.current = new Chart(chartRef.current, {
            type: 'bar',
            data: {
              labels: last6Months.map(m => m.label),
              datasets: [
                {
                  label: 'Gelir',
                  data: incomeData,
                  backgroundColor: 'rgba(16, 185, 129, 0.7)',
                  borderColor: 'rgb(16, 185, 129)',
                  borderWidth: 1
                },
                {
                  label: 'Gider',
                  data: expenseData,
                  backgroundColor: 'rgba(244, 63, 94, 0.7)',
                  borderColor: 'rgb(244, 63, 94)',
                  borderWidth: 1
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  labels: { color: '#9ca3af' }
                }
              },
              scales: {
                x: {
                  ticks: { color: '#9ca3af' },
                  grid: { color: 'rgba(255,255,255,0.1)' }
                },
                y: {
                  ticks: { color: '#9ca3af' },
                  grid: { color: 'rgba(255,255,255,0.1)' }
                }
              }
            }
          });
        }
      }, [activeTab, transactions]);

      return (
        <div className={`min-h-screen transition-all duration-300 ${
          darkMode 
            ? 'bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900' 
            : 'bg-gradient-to-br from-slate-200 via-slate-100 to-slate-200'
        }`}>
          {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
          
          <div className="max-w-6xl mx-auto px-3 py-4 md:px-6 md:py-6">
            {/* Header */}
            <div className="flex justify-between items-center mb-4 md:mb-6 no-print">
              <div>
                <h1 className={`text-xl md:text-2xl lg:text-3xl font-bold ${darkMode ? 'text-white' : 'text-slate-800'}`}>üí∞ Gelir-Gider Takibi</h1>
                {syncEnabled && (
                  <div className="flex items-center gap-2 mt-1">
                    <div className={`w-2 h-2 rounded-full ${isSyncing ? 'bg-amber-400 animate-pulse' : 'bg-emerald-400'}`}></div>
                    <span className={`text-xs ${darkMode ? 'text-gray-400' : 'text-slate-600'}`}>
                      {isSyncing ? 'Senkronize ediliyor...' : lastSyncTime ? `Son sync: ${lastSyncTime.toLocaleTimeString('tr-TR')}` : '‚òÅÔ∏è Bulut aktif'}
                    </span>
                  </div>
                )}
              </div>
              <div className="flex gap-2 items-center">
                {/* Tema Toggle Butonlarƒ± */}
                <div className="flex items-center gap-1 bg-white/5 rounded-lg p-1">
                  <button
                    onClick={() => setDarkMode(!darkMode)}
                    className={`p-2 rounded-md transition-all ${darkMode ? 'bg-slate-700 text-yellow-400' : 'bg-amber-100 text-amber-600'}`}
                    title={darkMode ? 'A√ßƒ±k Tema' : 'Koyu Tema'}
                  >
                    {darkMode ? 'üåô' : '‚òÄÔ∏è'}
                  </button>
                  <button
                    onClick={() => setVividColors(!vividColors)}
                    className={`p-2 rounded-md transition-all ${vividColors ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white' : 'bg-slate-600 text-gray-400'}`}
                    title={vividColors ? 'Pastel Renkler' : 'Canlƒ± Renkler'}
                  >
                    üé®
                  </button>
                </div>
                
                {/* Sync Butonu */}
                <button
                  onClick={() => setShowSyncModal(true)}
                  className={`flex items-center gap-2 px-3 py-2 rounded-lg transition-all ${
                    syncStatus === SYNC_STATUS.SYNCED ? 'bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400' :
                    syncStatus === SYNC_STATUS.SYNCING ? 'bg-blue-500/20 hover:bg-blue-500/30 text-blue-400' :
                    syncStatus === SYNC_STATUS.PENDING ? 'bg-amber-500/20 hover:bg-amber-500/30 text-amber-400' :
                    syncStatus === SYNC_STATUS.CONFLICT ? 'bg-orange-500/20 hover:bg-orange-500/30 text-orange-400' :
                    syncStatus === SYNC_STATUS.OFFLINE ? 'bg-rose-500/20 hover:bg-rose-500/30 text-rose-400' :
                    !syncEnabled ? 'bg-white/5 hover:bg-white/10 text-gray-400' :
                    'bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400'
                  }`}
                  title="Bulut Senkronizasyon"
                >
                  {isSyncing ? (
                    <span className="w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"></span>
                  ) : syncStatus === SYNC_STATUS.SYNCED ? (
                    <span>üü¢</span>
                  ) : syncStatus === SYNC_STATUS.PENDING ? (
                    <span>üü°</span>
                  ) : syncStatus === SYNC_STATUS.CONFLICT ? (
                    <span>üü†</span>
                  ) : syncStatus === SYNC_STATUS.OFFLINE ? (
                    <span>üî¥</span>
                  ) : (
                    <span>‚òÅÔ∏è</span>
                  )}
                  <span className="hidden md:inline text-sm">
                    {!syncEnabled ? 'Sync' :
                     syncStatus === SYNC_STATUS.SYNCED ? 'Senkron' :
                     syncStatus === SYNC_STATUS.SYNCING ? 'Y√ºkleniyor...' :
                     syncStatus === SYNC_STATUS.PENDING ? 'Bekliyor' :
                     syncStatus === SYNC_STATUS.CONFLICT ? '√áakƒ±≈üma!' :
                     syncStatus === SYNC_STATUS.OFFLINE ? 'Baƒülantƒ± yok' : 'Baƒülƒ±'}
                  </span>
                </button>
                <button
                  onClick={() => setShowBackupModal(true)}
                  className="bg-white/5 hover:bg-white/10 text-gray-400 p-2 rounded-lg transition-all"
                  title="Yedekleme"
                >
                  üíæ
                </button>
                <button
                  onClick={printReport}
                  className="bg-white/5 hover:bg-white/10 text-gray-400 p-2 rounded-lg transition-all"
                  title="Yazdƒ±r"
                >
                  üñ®Ô∏è
                </button>
              </div>
            </div>

            {/* Print Header */}
            <div className="print-only text-center mb-8">
              <h1 className="text-2xl font-bold">Gelir-Gider Raporu</h1>
              <p className="text-gray-600">{new Date().toLocaleDateString('tr-TR')}</p>
            </div>

            {/* Tab Navigasyonu */}
            <div className="flex gap-2 mb-6 overflow-x-auto no-print">
              {[
                { id: 'islemler', icon: 'üìù', label: 'ƒ∞≈ülemler' },
                { id: 'ozet', icon: 'üìä', label: '√ñzet' },
                { id: 'grafikler', icon: 'üìà', label: 'Grafikler' },
                { id: 'hatirlatici', icon: 'üîî', label: 'Hatƒ±rlatƒ±cƒ±lar' }
              ].map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex-shrink-0 py-3 px-4 rounded-xl font-medium transition-all ${
                    activeTab === tab.id
                      ? 'bg-indigo-500 text-white'
                      : 'bg-white/5 text-gray-400 hover:bg-white/10'
                  }`}
                >
                  {tab.icon} {tab.label}
                </button>
              ))}
            </div>

            {/* ==================== ƒ∞≈ûLEMLER TAB ==================== */}
            {activeTab === 'islemler' && (
            <>
              {/* Kasa Kartlarƒ± */}
              <div className="bg-white/5 border border-white/10 rounded-2xl p-4 mb-4">
                <div className="flex items-center justify-between mb-3">
                  <div className="flex items-center gap-2">
                    <span className="text-xl">üè¶</span>
                    <h2 className="text-white font-semibold">Kasalar</h2>
                  </div>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setShowKasaModal(true)}
                      className="bg-white/10 hover:bg-white/20 text-gray-300 px-3 py-1 rounded-lg text-sm transition-all"
                    >
                      ‚úèÔ∏è D√ºzenle
                    </button>
                    <button
                      onClick={() => setShowKasaModal(true)}
                      className="bg-indigo-500 hover:bg-indigo-600 text-white px-3 py-1 rounded-lg text-sm transition-all"
                    >
                      + Ekle
                    </button>
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-3">
                  {kasalar.map(kasa => {
                    const colorClasses = {
                      emerald: 'bg-emerald-500/20 border-emerald-500/30 text-emerald-400 text-emerald-300',
                      blue: 'bg-blue-500/20 border-blue-500/30 text-blue-400 text-blue-300',
                      purple: 'bg-purple-500/20 border-purple-500/30 text-purple-400 text-purple-300',
                      pink: 'bg-pink-500/20 border-pink-500/30 text-pink-400 text-pink-300',
                      amber: 'bg-amber-500/20 border-amber-500/30 text-amber-400 text-amber-300',
                      cyan: 'bg-cyan-500/20 border-cyan-500/30 text-cyan-400 text-cyan-300',
                      indigo: 'bg-indigo-500/20 border-indigo-500/30 text-indigo-400 text-indigo-300',
                      rose: 'bg-rose-500/20 border-rose-500/30 text-rose-400 text-rose-300',
                      teal: 'bg-teal-500/20 border-teal-500/30 text-teal-400 text-teal-300'
                    };
                    const isHarici = kasa.isMainKasa === false;
                    const colors = isHarici ? 'bg-gray-500/10 border-gray-500/30 text-gray-400 text-gray-300' : (colorClasses[kasa.color] || colorClasses.emerald);
                    const [bgColor, borderColor, textColor, valueColor] = colors.split(' ');
                    
                    return (
                      <div key={kasa.id} className={`${bgColor} border ${borderColor} rounded-xl p-3 relative group`}>
                        {kasa.id !== 'nakit' && kasa.id !== 'kredikarti' && (
                          <button
                            onClick={() => deleteKasa(kasa.id)}
                            className="absolute top-2 right-2 text-gray-500 hover:text-rose-400 opacity-0 group-hover:opacity-100 transition-all text-sm"
                          >
                            ‚úï
                          </button>
                        )}
                        <div className="flex items-center gap-2 mb-1">
                          <span className="text-lg">{kasa.icon}</span>
                          <p className={`${textColor} font-medium text-sm`}>{kasa.name}</p>
                          {isHarici && <span className="text-xs bg-gray-500/30 text-gray-400 px-1.5 py-0.5 rounded">Harici</span>}
                        </div>
                        <p className={`${valueColor} text-lg font-bold`}>{formatMoney(kasaBakiyeleri[kasa.id] || 0)}</p>
                      </div>
                    );
                  })}
                </div>
                {/* Ana Kasa Toplam ve Harici Toplam */}
                <div className="grid grid-cols-2 gap-3 mt-3">
                  <div className="bg-gradient-to-r from-indigo-500/20 to-violet-500/20 border border-indigo-500/30 rounded-xl p-3">
                    <p className="text-indigo-400 text-xs mb-1">üíº Ana Kasalar Toplamƒ±</p>
                    <p className="text-indigo-300 text-xl font-bold">{formatMoney(toplamKasaBakiye)}</p>
                  </div>
                  {hariciKasaBakiye !== 0 && (
                    <div className="bg-gray-500/10 border border-gray-500/30 rounded-xl p-3">
                      <p className="text-gray-400 text-xs mb-1">üì¶ Harici Kasalar</p>
                      <p className="text-gray-300 text-xl font-bold">{formatMoney(hariciKasaBakiye)}</p>
                    </div>
                  )}
                </div>
              </div>

              {/* √ñzet Kartlarƒ± */}
              <div className="grid grid-cols-3 gap-2 md:gap-4 mb-6">
                <div className="bg-emerald-500/20 border border-emerald-500/30 rounded-xl p-3 text-center">
                  <p className="text-emerald-400 text-xs md:text-sm mb-1">Toplam Gelir</p>
                  <p className="text-emerald-300 text-sm md:text-xl font-bold">{formatMoney(totalIncome)}</p>
                </div>
                <div className="bg-rose-500/20 border border-rose-500/30 rounded-xl p-3 text-center">
                  <p className="text-rose-400 text-xs md:text-sm mb-1">Toplam Gider</p>
                  <p className="text-rose-300 text-sm md:text-xl font-bold">{formatMoney(totalExpense)}</p>
                </div>
                <div className={`${balance >= 0 ? 'bg-violet-500/20 border-violet-500/30' : 'bg-orange-500/20 border-orange-500/30'} border rounded-xl p-3 text-center`}>
                  <p className={`${balance >= 0 ? 'text-violet-400' : 'text-orange-400'} text-xs md:text-sm mb-1`}>Net Bakiye</p>
                  <p className={`${balance >= 0 ? 'text-violet-300' : 'text-orange-300'} text-sm md:text-xl font-bold`}>{formatMoney(balance)}</p>
                </div>
              </div>

              {/* Transfer Butonu */}
              <button
                onClick={() => setShowTransferModal(true)}
                className="w-full bg-gradient-to-r from-indigo-500/20 to-violet-500/20 border border-indigo-500/30 text-indigo-300 py-3 rounded-xl mb-6 hover:from-indigo-500/30 hover:to-violet-500/30 transition-all no-print"
              >
                üí± Kasalar Arasƒ± Transfer
              </button>

              {/* Yeni ƒ∞≈ülem Formu */}
              <div className="bg-white/5 border border-white/10 rounded-2xl p-4 md:p-6 mb-6 no-print">
                <h2 className="text-white text-lg font-semibold mb-4">Yeni ƒ∞≈ülem Ekle</h2>
                
                {/* Gelir/Gider Se√ßimi */}
                <div className="flex gap-2 mb-4">
                  <button
                    onClick={() => { setType('gelir'); setCategory(''); }}
                    className={`flex-1 py-3 rounded-xl font-medium transition-all ${
                      type === 'gelir' ? 'bg-emerald-500 text-white' : 'bg-white/5 text-gray-400 hover:bg-white/10'
                    }`}
                  >
                    ‚Üó Gelir
                  </button>
                  <button
                    onClick={() => { setType('gider'); setCategory(''); }}
                    className={`flex-1 py-3 rounded-xl font-medium transition-all ${
                      type === 'gider' ? 'bg-rose-500 text-white' : 'bg-white/5 text-gray-400 hover:bg-white/10'
                    }`}
                  >
                    ‚Üô Gider
                  </button>
                </div>

                {/* Kategori Se√ßimi */}
                <div className="mb-4">
                  <div className="flex items-center justify-between mb-2">
                    <p className="text-gray-400 text-sm">{type === 'gelir' ? 'Gelir Kategorisi:' : 'Gider Kategorisi:'}</p>
                    <div className="flex gap-2">
                      <button
                        onClick={() => type === 'gelir' ? setShowGelirKategoriModal(true) : setShowGiderKategoriModal(true)}
                        className="text-gray-400 hover:text-gray-300 text-xs transition-all"
                      >
                        ‚úèÔ∏è D√ºzenle
                      </button>
                      <button
                        onClick={() => type === 'gelir' ? setShowGelirKategoriModal(true) : setShowGiderKategoriModal(true)}
                        className="text-indigo-400 hover:text-indigo-300 text-xs transition-all"
                      >
                        + Ekle
                      </button>
                    </div>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    {categories[type].map(cat => (
                      <button
                        key={cat}
                        onClick={() => setCategory(cat)}
                        className={`px-3 py-2 rounded-lg text-sm transition-all ${
                          category === cat
                            ? type === 'gelir' ? 'bg-emerald-500/30 text-emerald-300 border border-emerald-500' : 'bg-rose-500/30 text-rose-300 border border-rose-500'
                            : 'bg-white/5 text-gray-400 hover:bg-white/10 border border-transparent'
                        }`}
                      >
                        {cat}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Kasa Se√ßimi (Gelir ve Gider i√ßin) - Dinamik */}
                <div className="mb-4">
                  <p className="text-gray-400 text-sm mb-2">{type === 'gelir' ? 'Gelir Kasasƒ±:' : '√ñdeme Yapƒ±lan Kasa:'}</p>
                  <div className="flex flex-wrap gap-2">
                    {kasalar.map(kasa => (
                      <button
                        key={kasa.id}
                        onClick={() => setPaymentMethod(kasa.id)}
                        className={`px-4 py-2 rounded-xl font-medium transition-all flex items-center gap-2 ${
                          paymentMethod === kasa.id 
                            ? type === 'gelir' ? 'bg-emerald-600 text-white' : 'bg-rose-600 text-white'
                            : 'bg-white/5 text-gray-400 hover:bg-white/10'
                        }`}
                      >
                        {kasa.icon} {kasa.name}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Tarih Se√ßimi */}
                <div className="mb-4">
                  <label className="text-gray-400 text-sm mb-1 block">Tarih:</label>
                  <input
                    type="date"
                    value={selectedDate}
                    onChange={(e) => setSelectedDate(e.target.value)}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>

                {/* A√ßƒ±klama, Tutar, Not */}
                <div className="space-y-3">
                  <input
                    type="text"
                    placeholder="A√ßƒ±klama..."
                    value={description}
                    onChange={(e) => setDescription(e.target.value)}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-white/30"
                  />
                  <div className="flex gap-3">
                    <input
                      type="number"
                      placeholder="Tutar"
                      value={amount}
                      onChange={(e) => setAmount(e.target.value)}
                      className="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-white/30"
                    />
                    <button
                      onClick={addTransaction}
                      className="bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-xl font-medium transition-all"
                    >
                      Ekle
                    </button>
                  </div>
                  <input
                    type="text"
                    placeholder="Not (opsiyonel)..."
                    value={note}
                    onChange={(e) => setNote(e.target.value)}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-white/30"
                  />
                </div>
              </div>

              {/* Arama ve Filtreler */}
              <div className="bg-white/5 border border-white/10 rounded-2xl p-4 md:p-6 no-print">
                <div className="flex flex-col gap-4 mb-4">
                  <div className="flex gap-2 items-center">
                    <h2 className="text-white text-lg font-semibold flex-1">ƒ∞≈ülem Ge√ßmi≈üi</h2>
                    <button
                      onClick={exportToExcel}
                      className="bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-lg text-sm hover:bg-emerald-500/30 transition-all"
                    >
                      üì§ Excel
                    </button>
                  </div>
                  
                  {/* Arama */}
                  <input
                    type="text"
                    placeholder="üîç ƒ∞≈ülem ara..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-white/30"
                  />
                  
                  {/* Filtreler */}
                  <div className="flex flex-wrap gap-2">
                    {['all', 'gelir', 'gider', 'transfer'].map(f => (
                      <button
                        key={f}
                        onClick={() => setFilterType(f)}
                        className={`px-3 py-1 rounded-lg text-sm transition-all ${
                          filterType === f ? 'bg-indigo-500 text-white' : 'bg-white/5 text-gray-400 hover:bg-white/10'
                        }`}
                      >
                        {f === 'all' ? 'T√ºm√º' : f === 'gelir' ? 'Gelirler' : f === 'gider' ? 'Giderler' : 'Transferler'}
                      </button>
                    ))}
                    <span className="text-gray-600">|</span>
                    {['all', 'nakit', 'kredikarti'].map(f => (
                      <button
                        key={f}
                        onClick={() => setFilterKasa(f)}
                        className={`px-3 py-1 rounded-lg text-sm transition-all ${
                          filterKasa === f 
                            ? f === 'nakit' ? 'bg-emerald-500 text-white' : f === 'kredikarti' ? 'bg-blue-500 text-white' : 'bg-violet-500 text-white'
                            : 'bg-white/5 text-gray-400 hover:bg-white/10'
                        }`}
                      >
                        {f === 'all' ? 'T√ºm Kasalar' : f === 'nakit' ? 'üíµ' : 'üí≥'}
                      </button>
                    ))}
                  </div>
                </div>

                {/* ƒ∞≈ülem Listesi */}
                {filteredTransactions.length === 0 ? (
                  <p className="text-gray-500 text-center py-8">Hen√ºz i≈ülem yok</p>
                ) : (
                  <div className="space-y-3 max-h-96 overflow-y-auto">
                    {filteredTransactions.map(t => (
                      <div
                        key={t.id}
                        className={`flex items-start justify-between p-4 rounded-xl ${
                          t.type === 'gelir' ? (t.paymentMethod === 'nakit' ? 'bg-emerald-500/10' : 'bg-blue-500/10')
                            : t.type === 'gider' ? 'bg-rose-500/10'
                            : 'bg-violet-500/10'
                        }`}
                      >
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2 flex-wrap">
                            <p className="text-white font-medium truncate">{t.description}</p>
                            {(t.type === 'gelir' || t.type === 'gider') && t.paymentMethod && (
                              <span className={`text-xs px-2 py-0.5 rounded-full flex-shrink-0 ${
                                t.type === 'gelir' 
                                  ? 'bg-white/10' 
                                  : t.paymentMethod === 'nakit' ? 'bg-rose-500/20 text-rose-300' : 'bg-rose-500/20 text-rose-300'
                              }`}>
                                {t.paymentMethod === 'nakit' ? 'üíµ' : 'üí≥'}
                              </span>
                            )}
                            {(t.type === 'transfer-in' || t.type === 'transfer-out') && (
                              <span className="text-xs px-2 py-0.5 rounded-full bg-violet-500/30 text-violet-300 flex-shrink-0">
                                üí± Transfer
                              </span>
                            )}
                          </div>
                          <p className="text-gray-400 text-sm">{t.category} ‚Ä¢ {t.date}</p>
                          {t.note && <p className="text-gray-500 text-xs mt-1">üìù {t.note}</p>}
                        </div>
                        <div className="flex items-center gap-2 ml-2">
                          <p className={`font-bold text-right ${
                            t.type === 'gelir' ? (t.paymentMethod === 'nakit' ? 'text-emerald-400' : 'text-blue-400')
                              : t.type === 'gider' ? 'text-rose-400'
                              : t.type === 'transfer-in' ? 'text-violet-400' : 'text-violet-400'
                          }`}>
                            {t.type === 'gelir' || t.type === 'transfer-in' ? '+' : '-'}{formatMoney(t.amount)}
                          </p>
                          <button
                            onClick={() => startEdit(t)}
                            className="text-gray-500 hover:text-blue-400 transition-colors p-1"
                          >
                            ‚úèÔ∏è
                          </button>
                          <button
                            onClick={() => deleteTransaction(t.id)}
                            className="text-gray-500 hover:text-rose-400 transition-colors p-1"
                          >
                            üóëÔ∏è
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* ==================== CARƒ∞ HESAPLAR B√ñL√úM√ú ==================== */}
              <div className="bg-white/5 border border-white/10 rounded-2xl p-4 md:p-6 mb-6">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center gap-2">
                    <span className="text-xl">üë•</span>
                    <h2 className="text-white text-lg font-semibold">Cari Hesaplar</h2>
                  </div>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setShowCariModal(true)}
                      className="bg-white/10 hover:bg-white/20 text-gray-300 px-3 py-2 rounded-xl text-sm transition-all"
                    >
                      ‚úèÔ∏è D√ºzenle
                    </button>
                    <button
                      onClick={() => setShowCariModal(true)}
                      className="bg-indigo-500 hover:bg-indigo-600 text-white px-3 py-2 rounded-xl text-sm transition-all"
                    >
                      + Ekle
                    </button>
                  </div>
                </div>

                {/* Cari √ñzet Kartlarƒ± */}
                <div className="grid grid-cols-3 gap-2 md:gap-4 mb-4">
                  <div className="bg-cyan-500/20 border border-cyan-500/30 rounded-xl p-3 text-center">
                    <p className="text-cyan-400 text-xs md:text-sm mb-1">Alacak</p>
                    <p className="text-cyan-300 text-sm md:text-lg font-bold">{formatMoney(totalCariAlacak)}</p>
                  </div>
                  <div className="bg-orange-500/20 border border-orange-500/30 rounded-xl p-3 text-center">
                    <p className="text-orange-400 text-xs md:text-sm mb-1">Bor√ß</p>
                    <p className="text-orange-300 text-sm md:text-lg font-bold">{formatMoney(totalCariBorc)}</p>
                  </div>
                  <div className={`${totalCariBakiye >= 0 ? 'bg-emerald-500/20 border-emerald-500/30' : 'bg-rose-500/20 border-rose-500/30'} border rounded-xl p-3 text-center`}>
                    <p className={`${totalCariBakiye >= 0 ? 'text-emerald-400' : 'text-rose-400'} text-xs md:text-sm mb-1`}>Bakiye</p>
                    <p className={`${totalCariBakiye >= 0 ? 'text-emerald-300' : 'text-rose-300'} text-sm md:text-lg font-bold`}>{formatMoney(totalCariBakiye)}</p>
                  </div>
                </div>

                {/* Yakla≈üan Vadeler */}
                {getYaklasanVadeler().length > 0 && (
                  <div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-3 mb-4">
                    <p className="text-amber-400 text-sm font-medium mb-2">‚è∞ Yakla≈üan Vadeler</p>
                    <div className="space-y-2">
                      {getYaklasanVadeler().slice(0, 3).map(v => (
                        <div key={v.id} className="flex justify-between items-center text-sm">
                          <span className="text-gray-300">{v.cariName}</span>
                          <div className="flex items-center gap-2">
                            <span className="text-amber-400">{formatMoney(v.amount)}</span>
                            <span className={`text-xs px-2 py-0.5 rounded-full ${
                              v.diffDays === 0 ? 'bg-rose-500 text-white' : 
                              v.diffDays <= 3 ? 'bg-amber-500 text-white' : 'bg-gray-600 text-gray-300'
                            }`}>
                              {v.diffDays === 0 ? 'BUG√úN' : `${v.diffDays} g√ºn`}
                            </span>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Cari Hesap Listesi - Grid/D√∂≈üeme D√ºzeni */}
                {cariHesaplar.length === 0 ? (
                  <p className="text-gray-500 text-center py-6">Hen√ºz cari hesap yok</p>
                ) : (
                  <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    {cariHesaplar.map(cari => {
                      const balance = getCariBalance(cari.id);
                      return (
                        <div
                          key={cari.id}
                          onClick={() => { setSelectedCari(cari); setShowCariDetailModal(true); }}
                          className={`relative p-4 rounded-2xl cursor-pointer transition-all transform hover:scale-105 hover:shadow-lg ${
                            balance.bakiye >= 0 
                              ? 'bg-gradient-to-br from-cyan-500/20 to-blue-500/20 border border-cyan-500/30 hover:border-cyan-400/50' 
                              : 'bg-gradient-to-br from-orange-500/20 to-rose-500/20 border border-orange-500/30 hover:border-orange-400/50'
                          }`}
                        >
                          {/* Tip ƒ∞konu */}
                          <div className={`w-12 h-12 rounded-xl flex items-center justify-center mb-3 ${
                            cari.type === 'firma' ? 'bg-blue-500/30 text-blue-300' : 
                            cari.type === 'kisi' ? 'bg-purple-500/30 text-purple-300' : 'bg-gray-500/30 text-gray-300'
                          }`}>
                            <span className="text-2xl">{cari.type === 'firma' ? 'üè¢' : cari.type === 'kisi' ? 'üë§' : 'üìÅ'}</span>
                          </div>
                          
                          {/* ƒ∞sim ve Tip */}
                          <p className="text-white font-semibold text-sm truncate mb-1">{cari.name}</p>
                          <p className="text-gray-400 text-xs mb-3">
                            {cari.type === 'firma' ? 'Firma' : cari.type === 'kisi' ? 'Ki≈üi' : 'Diƒüer'}
                          </p>
                          
                          {/* Bakiye */}
                          <div className={`text-center py-2 px-3 rounded-xl ${
                            balance.bakiye >= 0 
                              ? 'bg-cyan-500/20' 
                              : 'bg-orange-500/20'
                          }`}>
                            <p className={`font-bold text-lg ${balance.bakiye >= 0 ? 'text-cyan-300' : 'text-orange-300'}`}>
                              {balance.bakiye >= 0 ? '+' : ''}{formatMoney(balance.bakiye)}
                            </p>
                            <p className={`text-xs ${balance.bakiye >= 0 ? 'text-cyan-400' : 'text-orange-400'}`}>
                              {balance.bakiye >= 0 ? 'Alacak' : 'Bor√ß'}
                            </p>
                          </div>
                          
                          {/* Telefon varsa g√∂ster */}
                          {cari.phone && (
                            <p className="text-gray-500 text-xs mt-2 truncate">üìû {cari.phone}</p>
                          )}
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            </>
            )}

            {/* ==================== √ñZET TAB ==================== */}
            {activeTab === 'ozet' && (
            <>
              {/* Sekme Butonlarƒ± */}
              <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                <button
                  onClick={() => setOzetViewMode('today')}
                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${
                    ozetViewMode === 'today' ? 'bg-indigo-500 text-white' : 'bg-white/10 text-gray-400 hover:bg-white/20'
                  }`}
                >
                  üìÖ Bug√ºn
                </button>
                <button
                  onClick={() => setOzetViewMode('month')}
                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${
                    ozetViewMode === 'month' ? 'bg-indigo-500 text-white' : 'bg-white/10 text-gray-400 hover:bg-white/20'
                  }`}
                >
                  üóìÔ∏è Bu Ay
                </button>
                <button
                  onClick={() => setOzetViewMode('year')}
                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${
                    ozetViewMode === 'year' ? 'bg-indigo-500 text-white' : 'bg-white/10 text-gray-400 hover:bg-white/20'
                  }`}
                >
                  üìÜ Bu Yƒ±l
                </button>
                <button
                  onClick={() => setOzetViewMode('custom')}
                  className={`px-4 py-2 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${
                    ozetViewMode === 'custom' ? 'bg-indigo-500 text-white' : 'bg-white/10 text-gray-400 hover:bg-white/20'
                  }`}
                >
                  üîç Tarih Se√ß
                </button>
              </div>

              {/* Tarih Se√ßici (sadece custom modda) */}
              {ozetViewMode === 'custom' && (
                <div className="bg-white/5 border border-white/10 rounded-xl p-4 mb-6">
                  <div className="flex flex-wrap gap-3 items-end">
                    <div className="flex-1 min-w-[130px]">
                      <label className="text-gray-400 text-xs mb-1 block">Ba≈ülangƒ±√ß</label>
                      <input
                        type="date"
                        value={ozetStartDate}
                        onChange={(e) => setOzetStartDate(e.target.value)}
                        className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-indigo-500"
                      />
                    </div>
                    <div className="flex-1 min-w-[130px]">
                      <label className="text-gray-400 text-xs mb-1 block">Biti≈ü</label>
                      <input
                        type="date"
                        value={ozetEndDate}
                        onChange={(e) => setOzetEndDate(e.target.value)}
                        className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-indigo-500"
                      />
                    </div>
                    <button
                      onClick={() => { setOzetStartDate(''); setOzetEndDate(''); }}
                      className="bg-white/5 hover:bg-white/10 text-gray-400 px-3 py-2 rounded-lg text-sm transition-all"
                    >
                      Temizle
                    </button>
                  </div>
                </div>
              )}

              {/* √ñzet ƒ∞√ßeriƒüi */}
              {(() => {
                let filteredTx = [];
                let periodTitle = '';
                const now = new Date();
                const todayStr = getTodayString();
                
                if (ozetViewMode === 'today') {
                  filteredTx = transactions.filter(t => t.date === todayStr);
                  periodTitle = `Bug√ºn (${todayStr})`;
                } else if (ozetViewMode === 'month') {
                  filteredTx = monthTransactions;
                  periodTitle = new Date().toLocaleDateString('tr-TR', { month: 'long', year: 'numeric' });
                } else if (ozetViewMode === 'year') {
                  const currentYear = now.getFullYear();
                  filteredTx = transactions.filter(t => {
                    const [day, month, year] = t.date.split('.').map(Number);
                    return year === currentYear;
                  });
                  periodTitle = `${currentYear} Yƒ±lƒ±`;
                } else if (ozetViewMode === 'custom') {
                  if (ozetStartDate && ozetEndDate) {
                    filteredTx = transactions.filter(t => isInDateRange(t.date, ozetStartDate, ozetEndDate));
                    periodTitle = `${formatDateTR(ozetStartDate)} - ${formatDateTR(ozetEndDate)}`;
                  } else if (ozetStartDate) {
                    filteredTx = transactions.filter(t => isInDateRange(t.date, ozetStartDate, null));
                    periodTitle = `${formatDateTR(ozetStartDate)} ve sonrasƒ±`;
                  } else if (ozetEndDate) {
                    filteredTx = transactions.filter(t => isInDateRange(t.date, null, ozetEndDate));
                    periodTitle = `${formatDateTR(ozetEndDate)} ve √∂ncesi`;
                  } else {
                    periodTitle = 'Tarih se√ßin';
                  }
                }

                const periodIncome = filteredTx.filter(t => t.type === 'gelir').reduce((s, t) => s + t.amount, 0);
                const periodExpense = filteredTx.filter(t => t.type === 'gider').reduce((s, t) => s + t.amount, 0);
                const periodNet = periodIncome - periodExpense;
                const periodIncomeNakit = filteredTx.filter(t => t.type === 'gelir' && t.paymentMethod === 'nakit').reduce((s, t) => s + t.amount, 0);
                const periodIncomeKrediKarti = filteredTx.filter(t => t.type === 'gelir' && t.paymentMethod === 'kredikarti').reduce((s, t) => s + t.amount, 0);
                
                const periodExpenseByCategory = categories.gider.map(cat => ({
                  category: cat,
                  amount: filteredTx.filter(t => t.type === 'gider' && t.category === cat).reduce((s, t) => s + t.amount, 0)
                })).filter(item => item.amount > 0).sort((a, b) => b.amount - a.amount);

                return (
                  <div className="bg-white/5 border border-white/10 rounded-2xl p-6 mb-6">
                    <h2 className="text-white text-lg font-semibold mb-4">{periodTitle}</h2>
                    
                    {ozetViewMode === 'custom' && !ozetStartDate && !ozetEndDate ? (
                      <p className="text-gray-500 text-center py-8">Yukarƒ±dan tarih aralƒ±ƒüƒ± se√ßin</p>
                    ) : (
                      <>
                        {/* Ana √ñzet */}
                        <div className="grid grid-cols-3 gap-3 mb-4">
                          <div className="bg-emerald-500/20 rounded-xl p-3 text-center">
                            <p className="text-emerald-400 text-xs">Gelir</p>
                            <p className="text-emerald-300 text-lg font-bold">{formatMoney(periodIncome)}</p>
                          </div>
                          <div className="bg-rose-500/20 rounded-xl p-3 text-center">
                            <p className="text-rose-400 text-xs">Gider</p>
                            <p className="text-rose-300 text-lg font-bold">{formatMoney(periodExpense)}</p>
                          </div>
                          <div className={`${periodNet >= 0 ? 'bg-violet-500/20' : 'bg-orange-500/20'} rounded-xl p-3 text-center`}>
                            <p className={`${periodNet >= 0 ? 'text-violet-400' : 'text-orange-400'} text-xs`}>Net</p>
                            <p className={`${periodNet >= 0 ? 'text-violet-300' : 'text-orange-300'} text-lg font-bold`}>{formatMoney(periodNet)}</p>
                          </div>
                        </div>

                        {/* Kasa Detayƒ± */}
                        <div className="grid grid-cols-2 gap-3 mb-4">
                          <div className="bg-emerald-500/10 rounded-xl p-3">
                            <p className="text-emerald-400 text-xs">üíµ Nakit Gelir</p>
                            <p className="text-emerald-300 font-bold">{formatMoney(periodIncomeNakit)}</p>
                          </div>
                          <div className="bg-blue-500/10 rounded-xl p-3">
                            <p className="text-blue-400 text-xs">üí≥ K.Kartƒ± Gelir</p>
                            <p className="text-blue-300 font-bold">{formatMoney(periodIncomeKrediKarti)}</p>
                          </div>
                        </div>

                        {/* ƒ∞≈ülem Sayƒ±sƒ± */}
                        <p className="text-gray-500 text-xs text-center mb-4">{filteredTx.length} i≈ülem</p>

                        {/* Gider Daƒüƒ±lƒ±mƒ± */}
                        {periodExpenseByCategory.length > 0 && (
                          <div className="pt-4 border-t border-white/10">
                            <p className="text-gray-400 text-sm mb-3">Gider Daƒüƒ±lƒ±mƒ±</p>
                            <div className="space-y-2">
                              {periodExpenseByCategory.slice(0, 5).map(item => (
                                <div key={item.category} className="flex items-center justify-between">
                                  <span className="text-gray-300 text-sm">{item.category}</span>
                                  <div className="flex items-center gap-2">
                                    <div className="w-20 h-2 bg-white/10 rounded-full overflow-hidden">
                                      <div 
                                        className="h-full bg-rose-500 rounded-full" 
                                        style={{ width: `${Math.min(100, (item.amount / periodExpense) * 100)}%` }}
                                      />
                                    </div>
                                    <span className="text-rose-400 text-sm font-medium w-20 text-right">{formatMoney(item.amount)}</span>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </>
                    )}
                  </div>
                );
              })()}

              {/* T√ºm Zamanlar */}
              <div className="bg-gradient-to-r from-indigo-500/20 to-violet-500/20 border border-indigo-500/30 rounded-2xl p-6">
                <h2 className="text-white text-lg font-semibold mb-4">üíé Genel Bakiye</h2>
                <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-white/5 rounded-xl p-3">
                    <p className="text-emerald-400 text-xs">üíµ Nakit Kasa</p>
                    <p className="text-emerald-300 text-lg font-bold">{formatMoney(nakitKasa)}</p>
                  </div>
                  <div className="bg-white/5 rounded-xl p-3">
                    <p className="text-blue-400 text-xs">üí≥ K.Kartƒ± Kasa</p>
                    <p className="text-blue-300 text-lg font-bold">{formatMoney(krediKartiKasa)}</p>
                  </div>
                </div>
                <div className="grid grid-cols-3 gap-3">
                  <div className="text-center">
                    <p className="text-emerald-400 text-xs">T. Gelir</p>
                    <p className="text-emerald-300 text-lg font-bold">{formatMoney(totalIncome)}</p>
                  </div>
                  <div className="text-center">
                    <p className="text-rose-400 text-xs">T. Gider</p>
                    <p className="text-rose-300 text-lg font-bold">{formatMoney(totalExpense)}</p>
                  </div>
                  <div className="text-center">
                    <p className={`${balance >= 0 ? 'text-violet-400' : 'text-orange-400'} text-xs`}>Net</p>
                    <p className={`${balance >= 0 ? 'text-violet-300' : 'text-orange-300'} text-lg font-bold`}>{formatMoney(balance)}</p>
                  </div>
                </div>
              </div>
            </>
            )}

            {/* ==================== GRAFƒ∞KLER TAB ==================== */}
            {activeTab === 'grafikler' && (
              <div className="bg-white/5 border border-white/10 rounded-2xl p-6">
                <h2 className="text-white text-xl font-semibold mb-4">üìà Son 6 Ay Gelir-Gider Kar≈üƒ±la≈ütƒ±rmasƒ±</h2>
                <div className="h-80">
                  <canvas ref={chartRef}></canvas>
                </div>
              </div>
            )}

            {/* ==================== HATIRLATICILAR TAB ==================== */}
            {activeTab === 'hatirlatici' && (
            <>
              <div className="bg-white/5 border border-white/10 rounded-2xl p-6 mb-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-white text-xl font-semibold">üîî Hatƒ±rlatƒ±cƒ±lar</h2>
                  <button
                    onClick={() => setShowReminderModal(true)}
                    className="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-xl text-sm transition-all"
                  >
                    + Yeni Hatƒ±rlatƒ±cƒ±
                  </button>
                </div>
                
                {reminders.length === 0 ? (
                  <p className="text-gray-500 text-center py-8">Hen√ºz hatƒ±rlatƒ±cƒ± yok</p>
                ) : (
                  <div className="space-y-3">
                    {reminders.map(r => (
                      <div key={r.id} className="flex items-center justify-between p-4 bg-amber-500/10 rounded-xl">
                        <div>
                          <p className="text-white font-medium">{r.title}</p>
                          <p className="text-gray-400 text-sm">
                            {r.tekrar === 'tek' || r.vadeDate 
                              ? (r.vadeDate ? `üìÖ ${formatDateTR(r.vadeDate)}` : `üìÖ Ayƒ±n ${r.day}. g√ºn√º`) 
                              : `üîÑ Her ayƒ±n ${r.day}. g√ºn√º`
                            }
                            {r.tekrar === 'tek' && ' (Tek seferlik)'}
                            {r.tekrar === 'aylik' && ' (Her ay)'}
                            {!r.tekrar && !r.vadeDate && ' (Her ay)'}
                             ‚Ä¢ {r.category}
                          </p>
                        </div>
                        <div className="flex items-center gap-3">
                          <p className="text-amber-400 font-bold">{formatMoney(r.amount)}</p>
                          <button
                            onClick={() => deleteReminder(r.id)}
                            className="text-gray-500 hover:text-rose-400 transition-colors"
                          >
                            üóëÔ∏è
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div className="bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/30 rounded-2xl p-6">
                <h3 className="text-amber-400 font-semibold mb-2">üí° Hatƒ±rlatƒ±cƒ±lar Nasƒ±l √áalƒ±≈üƒ±r?</h3>
                <p className="text-gray-400 text-sm">
                  Belirlediƒüiniz g√ºnde uygulama a√ßƒ±kken size bildirim g√∂sterilir. 
                  √ñrneƒüin kira √∂demesi i√ßin her ayƒ±n 1'i, elektrik faturasƒ± i√ßin 15'i gibi.
                </p>
              </div>
            </>
            )}

            {/* ==================== MODALLER ==================== */}
            
            {/* D√ºzenleme Modal */}
            <Modal isOpen={showEditModal} onClose={() => setShowEditModal(false)} title="ƒ∞≈ülem D√ºzenle">
              {editingTransaction && (
                <div className="space-y-4">
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">A√ßƒ±klama</label>
                    <input
                      type="text"
                      value={editingTransaction.description}
                      onChange={(e) => setEditingTransaction({...editingTransaction, description: e.target.value})}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                  </div>
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">Tutar</label>
                    <input
                      type="number"
                      value={editingTransaction.amount}
                      onChange={(e) => setEditingTransaction({...editingTransaction, amount: e.target.value})}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                  </div>
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">Tarih</label>
                    <input
                      type="date"
                      value={editingTransaction.date}
                      onChange={(e) => setEditingTransaction({...editingTransaction, date: e.target.value})}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                  </div>
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">Not</label>
                    <input
                      type="text"
                      value={editingTransaction.note || ''}
                      onChange={(e) => setEditingTransaction({...editingTransaction, note: e.target.value})}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                  </div>
                  <button
                    onClick={saveEdit}
                    className="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-xl font-medium transition-all"
                  >
                    Kaydet
                  </button>
                </div>
              )}
            </Modal>

            {/* Transfer Modal */}
            <Modal isOpen={showTransferModal} onClose={() => setShowTransferModal(false)} title="üí± Kasalar Arasƒ± Transfer">
              <div className="space-y-4">
                <div>
                  <label className="text-gray-400 text-sm mb-2 block">Nereden:</label>
                  <div className="grid grid-cols-2 gap-2">
                    {kasalar.map(kasa => (
                      <button
                        key={kasa.id}
                        onClick={() => {
                          setTransferFrom(kasa.id);
                          if (transferTo === kasa.id) setTransferTo('');
                        }}
                        className={`py-3 px-3 rounded-xl font-medium transition-all text-sm ${
                          transferFrom === kasa.id 
                            ? `bg-${kasa.color || 'indigo'}-600 text-white` 
                            : 'bg-white/5 text-gray-400 hover:bg-white/10'
                        }`}
                      >
                        {kasa.icon} {kasa.name}
                      </button>
                    ))}
                  </div>
                </div>
                
                <div className="text-center text-gray-400 text-2xl">‚Üì</div>
                
                <div>
                  <label className="text-gray-400 text-sm mb-2 block">Nereye:</label>
                  <div className="grid grid-cols-2 gap-2">
                    {kasalar.filter(k => k.id !== transferFrom).map(kasa => (
                      <button
                        key={kasa.id}
                        onClick={() => setTransferTo(kasa.id)}
                        className={`py-3 px-3 rounded-xl font-medium transition-all text-sm ${
                          transferTo === kasa.id 
                            ? `bg-${kasa.color || 'indigo'}-600 text-white` 
                            : 'bg-white/5 text-gray-400 hover:bg-white/10'
                        }`}
                      >
                        {kasa.icon} {kasa.name}
                      </button>
                    ))}
                  </div>
                  {!transferFrom && (
                    <p className="text-gray-500 text-xs mt-2 text-center">√ñnce kaynak kasa se√ßin</p>
                  )}
                </div>
                
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Tutar</label>
                  <input
                    type="number"
                    placeholder="Transfer tutarƒ±"
                    value={transferAmount}
                    onChange={(e) => setTransferAmount(e.target.value)}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Not (opsiyonel)</label>
                  <input
                    type="text"
                    placeholder="Transfer notu"
                    value={transferNote}
                    onChange={(e) => setTransferNote(e.target.value)}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                
                {/* Transfer √ñzeti */}
                {transferFrom && transferTo && (
                  <div className="bg-indigo-500/10 border border-indigo-500/30 rounded-xl p-3">
                    <p className="text-indigo-400 text-sm text-center">
                      {kasalar.find(k => k.id === transferFrom)?.icon} {kasalar.find(k => k.id === transferFrom)?.name}
                      {' ‚Üí '}
                      {kasalar.find(k => k.id === transferTo)?.icon} {kasalar.find(k => k.id === transferTo)?.name}
                    </p>
                  </div>
                )}
                
                <button
                  onClick={handleTransfer}
                  disabled={!transferFrom || !transferTo}
                  className="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-xl font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  Transfer Yap
                </button>
              </div>
            </Modal>

            {/* Hatƒ±rlatƒ±cƒ± Modal */}
            <Modal isOpen={showReminderModal} onClose={() => setShowReminderModal(false)} title="üîî Yeni Hatƒ±rlatƒ±cƒ±">
              <div className="space-y-4">
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Ba≈ülƒ±k</label>
                  <input
                    type="text"
                    placeholder="√ñrn: Kira √ñdemesi"
                    value={newReminder.title}
                    onChange={(e) => setNewReminder({...newReminder, title: e.target.value})}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Tutar</label>
                  <input
                    type="number"
                    placeholder="Tutar"
                    value={newReminder.amount}
                    onChange={(e) => setNewReminder({...newReminder, amount: e.target.value})}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Kategori</label>
                  <select
                    value={newReminder.category}
                    onChange={(e) => setNewReminder({...newReminder, category: e.target.value})}
                    className="w-full bg-slate-700 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  >
                    {categories.gider.map(cat => (
                      <option key={cat} value={cat}>{cat}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Her ayƒ±n ka√ßƒ±nda?</label>
                  <input
                    type="number"
                    min="1"
                    max="31"
                    value={newReminder.day}
                    onChange={(e) => setNewReminder({...newReminder, day: parseInt(e.target.value) || 1})}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                <button
                  onClick={() => { addReminder(); setShowReminderModal(false); }}
                  className="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-xl font-medium transition-all"
                >
                  Hatƒ±rlatƒ±cƒ± Ekle
                </button>
              </div>
            </Modal>

            {/* Yedekleme Modal */}
            <Modal isOpen={showBackupModal} onClose={() => setShowBackupModal(false)} title="üíæ Yedekleme & Geri Y√ºkleme">
              <div className="space-y-4">
                <div className="bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4">
                  <h3 className="text-emerald-400 font-semibold mb-2">üì§ Yedek Al</h3>
                  <p className="text-gray-400 text-sm mb-3">T√ºm verilerinizi JSON dosyasƒ± olarak indirin.</p>
                  <button
                    onClick={backupData}
                    className="w-full bg-emerald-500 hover:bg-emerald-600 text-white py-2 rounded-xl transition-all"
                  >
                    Yedek ƒ∞ndir
                  </button>
                </div>
                
                <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                  <h3 className="text-blue-400 font-semibold mb-2">üì• Geri Y√ºkle</h3>
                  <p className="text-gray-400 text-sm mb-3">Daha √∂nce aldƒ±ƒüƒ±nƒ±z yedeƒüi geri y√ºkleyin.</p>
                  <label className="block w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-xl transition-all text-center cursor-pointer">
                    Yedek Dosyasƒ± Se√ß
                    <input
                      type="file"
                      accept=".json"
                      onChange={restoreData}
                      className="hidden"
                    />
                  </label>
                </div>

                <div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4">
                  <h3 className="text-amber-400 font-semibold mb-2">üì§ Excel'e Aktar</h3>
                  <p className="text-gray-400 text-sm mb-3">Verilerinizi Excel formatƒ±nda indirin.</p>
                  <button
                    onClick={exportToExcel}
                    className="w-full bg-amber-500 hover:bg-amber-600 text-white py-2 rounded-xl transition-all"
                  >
                    Excel ƒ∞ndir
                  </button>
                </div>

                <div className="bg-rose-500/10 border border-rose-500/30 rounded-xl p-4">
                  <h3 className="text-rose-400 font-semibold mb-2">üóëÔ∏è T√ºm Verileri Sil</h3>
                  <p className="text-gray-400 text-sm mb-3">Dikkat! Bu i≈ülem geri alƒ±namaz.</p>
                  <button
                    onClick={() => {
                      if (confirm('T√úM VERƒ∞LER Sƒ∞Lƒ∞NECEK! Emin misiniz?')) {
                        setTransactions([]);
                        setReminders([]);
                        setCariHesaplar([]);
                        setCariIslemler([]);
                        showToast('T√ºm veriler silindi', 'info');
                        setShowBackupModal(false);
                      }
                    }}
                    className="w-full bg-rose-500 hover:bg-rose-600 text-white py-2 rounded-xl transition-all"
                  >
                    T√ºm Verileri Sil
                  </button>
                </div>
              </div>
            </Modal>

            {/* ==================== CARƒ∞ HESAP MODALLARI ==================== */}
            
            {/* Yeni Cari Hesap Modal */}
            <Modal isOpen={showCariModal} onClose={() => setShowCariModal(false)} title="üë• Yeni Cari Hesap">
              <div className="space-y-4">
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Hesap Adƒ± *</label>
                  <input
                    type="text"
                    placeholder="Firma veya ki≈üi adƒ±"
                    value={newCari.name}
                    onChange={(e) => setNewCari({...newCari, name: e.target.value})}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                <div>
                  <label className="text-gray-400 text-sm mb-2 block">Hesap T√ºr√º</label>
                  <div className="flex gap-2">
                    {[
                      { id: 'firma', icon: 'üè¢', label: 'Firma' },
                      { id: 'kisi', icon: 'üë§', label: 'Ki≈üi' },
                      { id: 'diger', icon: 'üìÅ', label: 'Diƒüer' }
                    ].map(t => (
                      <button
                        key={t.id}
                        onClick={() => setNewCari({...newCari, type: t.id})}
                        className={`flex-1 py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 ${
                          newCari.type === t.id ? 'bg-indigo-500 text-white' : 'bg-white/5 text-gray-400 hover:bg-white/10'
                        }`}
                      >
                        {t.icon} {t.label}
                      </button>
                    ))}
                  </div>
                </div>
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Telefon (opsiyonel)</label>
                  <input
                    type="tel"
                    placeholder="05xx xxx xx xx"
                    value={newCari.phone}
                    onChange={(e) => setNewCari({...newCari, phone: e.target.value})}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Not (opsiyonel)</label>
                  <input
                    type="text"
                    placeholder="A√ßƒ±klama veya not"
                    value={newCari.note}
                    onChange={(e) => setNewCari({...newCari, note: e.target.value})}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                <button
                  onClick={addCariHesap}
                  className="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-xl font-medium transition-all"
                >
                  Cari Hesap Olu≈ütur
                </button>
              </div>
            </Modal>

            {/* Cari Hesap Detay Modal */}
            <Modal isOpen={showCariDetailModal} onClose={() => { setShowCariDetailModal(false); setEditingCari(null); }} title={selectedCari ? `${selectedCari.name}` : 'Cari Detay'}>
              {selectedCari && (
                <div className="space-y-4">
                  {/* Cari Bilgileri */}
                  <div className="bg-white/5 rounded-xl p-4">
                    <div className="flex items-center justify-between mb-3">
                      <div className="flex items-center gap-3">
                        <div className={`w-12 h-12 rounded-full flex items-center justify-center ${
                          selectedCari.type === 'firma' ? 'bg-blue-500/20 text-blue-400' : 
                          selectedCari.type === 'kisi' ? 'bg-purple-500/20 text-purple-400' : 'bg-gray-500/20 text-gray-400'
                        }`}>
                          {selectedCari.type === 'firma' ? 'üè¢' : selectedCari.type === 'kisi' ? 'üë§' : 'üìÅ'}
                        </div>
                        <div>
                          <p className="text-white font-semibold">{selectedCari.name}</p>
                          <p className="text-gray-500 text-sm">
                            {selectedCari.type === 'firma' ? 'Firma' : selectedCari.type === 'kisi' ? 'Ki≈üi' : 'Diƒüer'}
                            {selectedCari.phone && ` ‚Ä¢ ${selectedCari.phone}`}
                          </p>
                        </div>
                      </div>
                      <button
                        onClick={() => setEditingCari({...selectedCari})}
                        className="text-gray-500 hover:text-blue-400 transition-colors p-2"
                      >
                        ‚úèÔ∏è
                      </button>
                    </div>
                    {selectedCari.note && <p className="text-gray-400 text-sm">üìù {selectedCari.note}</p>}
                  </div>

                  {/* D√ºzenleme Formu */}
                  {editingCari && (
                    <div className="bg-indigo-500/10 border border-indigo-500/30 rounded-xl p-4 space-y-3">
                      <p className="text-indigo-400 font-medium text-sm">Cari Hesabƒ± D√ºzenle</p>
                      <input
                        type="text"
                        placeholder="Hesap Adƒ±"
                        value={editingCari.name}
                        onChange={(e) => setEditingCari({...editingCari, name: e.target.value})}
                        className="w-full bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-white focus:outline-none focus:border-indigo-500"
                      />
                      <div className="flex gap-2">
                        {['firma', 'kisi', 'diger'].map(t => (
                          <button
                            key={t}
                            onClick={() => setEditingCari({...editingCari, type: t})}
                            className={`flex-1 py-2 rounded-lg text-sm transition-all ${
                              editingCari.type === t ? 'bg-indigo-500 text-white' : 'bg-white/5 text-gray-400'
                            }`}
                          >
                            {t === 'firma' ? 'üè¢' : t === 'kisi' ? 'üë§' : 'üìÅ'}
                          </button>
                        ))}
                      </div>
                      <input
                        type="tel"
                        placeholder="Telefon"
                        value={editingCari.phone || ''}
                        onChange={(e) => setEditingCari({...editingCari, phone: e.target.value})}
                        className="w-full bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-white focus:outline-none focus:border-indigo-500"
                      />
                      <input
                        type="text"
                        placeholder="Not"
                        value={editingCari.note || ''}
                        onChange={(e) => setEditingCari({...editingCari, note: e.target.value})}
                        className="w-full bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-white focus:outline-none focus:border-indigo-500"
                      />
                      <div className="flex gap-2">
                        <button
                          onClick={() => setEditingCari(null)}
                          className="flex-1 bg-gray-600 hover:bg-gray-500 text-white py-2 rounded-xl transition-all"
                        >
                          ƒ∞ptal
                        </button>
                        <button
                          onClick={() => { updateCariHesap(); setSelectedCari(editingCari); }}
                          className="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white py-2 rounded-xl transition-all"
                        >
                          Kaydet
                        </button>
                      </div>
                    </div>
                  )}

                  {/* Bakiye √ñzeti */}
                  <div className="grid grid-cols-3 gap-2">
                    <div className="bg-cyan-500/20 rounded-xl p-3 text-center">
                      <p className="text-cyan-400 text-xs">Alacak</p>
                      <p className="text-cyan-300 font-bold">{formatMoney(getCariBalance(selectedCari.id).alacak)}</p>
                    </div>
                    <div className="bg-orange-500/20 rounded-xl p-3 text-center">
                      <p className="text-orange-400 text-xs">Bor√ß</p>
                      <p className="text-orange-300 font-bold">{formatMoney(getCariBalance(selectedCari.id).borc)}</p>
                    </div>
                    <div className={`${getCariBalance(selectedCari.id).bakiye >= 0 ? 'bg-emerald-500/20' : 'bg-rose-500/20'} rounded-xl p-3 text-center`}>
                      <p className={`${getCariBalance(selectedCari.id).bakiye >= 0 ? 'text-emerald-400' : 'text-rose-400'} text-xs`}>Bakiye</p>
                      <p className={`${getCariBalance(selectedCari.id).bakiye >= 0 ? 'text-emerald-300' : 'text-rose-300'} font-bold`}>
                        {formatMoney(getCariBalance(selectedCari.id).bakiye)}
                      </p>
                    </div>
                  </div>

                  {/* ƒ∞≈ülem Ekle Butonlarƒ± */}
                  <div className="flex gap-2">
                    <button
                      onClick={() => { setNewCariIslem({...newCariIslem, type: 'alacak'}); setShowCariIslemModal(true); }}
                      className="flex-1 bg-cyan-500 hover:bg-cyan-600 text-white py-3 rounded-xl font-medium transition-all"
                    >
                      + Alacak Ekle
                    </button>
                    <button
                      onClick={() => { setNewCariIslem({...newCariIslem, type: 'borc'}); setShowCariIslemModal(true); }}
                      className="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-xl font-medium transition-all"
                    >
                      + Bor√ß Ekle
                    </button>
                  </div>

                  {/* ==================== √ñDENMEMƒ∞≈û BOR√áLAR ==================== */}
                  {getOdenmemisBorclar(selectedCari.id).length > 0 && (
                    <div className="bg-orange-500/10 border border-orange-500/30 rounded-xl p-4">
                      <div className="flex items-center justify-between mb-3">
                        <p className="text-orange-400 font-medium">üìã √ñdenmemi≈ü Bor√ßlar</p>
                        <p className="text-orange-400 font-bold">{formatMoney(getToplamKalanBorc(selectedCari.id))}</p>
                      </div>
                      <div className="space-y-2 max-h-60 overflow-y-auto">
                        {getOdenmemisBorclar(selectedCari.id).map(borc => (
                          <div key={borc.id} className="bg-slate-800/50 rounded-lg p-3">
                            <div className="flex items-center justify-between mb-2">
                              <div>
                                <p className="text-white text-sm font-medium">{borc.description || 'Bor√ß'}</p>
                                <p className="text-gray-500 text-xs">{borc.date}</p>
                              </div>
                              <div className="text-right">
                                <p className="text-orange-400 font-bold">{formatMoney(borc.kalanBorc)}</p>
                                {borc.toplamOdenen > 0 && (
                                  <p className="text-emerald-400 text-xs">√ñdenen: {formatMoney(borc.toplamOdenen)}</p>
                                )}
                              </div>
                            </div>
                            <div className="flex gap-2">
                              <button
                                onClick={() => startOdeme(borc)}
                                className="flex-1 bg-emerald-500 hover:bg-emerald-600 text-white py-2 rounded-lg text-sm font-medium transition-all"
                              >
                                üíµ ≈ûimdi √ñde
                              </button>
                              <button
                                onClick={() => startOdemePlanla(borc)}
                                className="flex-1 bg-amber-500 hover:bg-amber-600 text-white py-2 rounded-lg text-sm font-medium transition-all"
                              >
                                üìÖ Planla
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* ==================== PLANLI √ñDEMELER ==================== */}
                  {getPlanliOdemeler(selectedCari.id).length > 0 && (
                    <div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4">
                      <p className="text-amber-400 font-medium mb-3">üìÖ Planlƒ± √ñdemeler</p>
                      <div className="space-y-2 max-h-40 overflow-y-auto">
                        {getPlanliOdemeler(selectedCari.id).map(planli => (
                          <div key={planli.id} className="bg-slate-800/50 rounded-lg p-3">
                            <div className="flex items-center justify-between mb-2">
                              <div>
                                <p className="text-white text-sm font-medium">
                                  {planli.description}
                                  {planli.tekrar === 'aylik' && <span className="ml-2 text-purple-400 text-xs">üîÑ Aylƒ±k</span>}
                                  {(!planli.tekrar || planli.tekrar === 'tek') && <span className="ml-2 text-indigo-400 text-xs">1Ô∏è‚É£ Tek</span>}
                                </p>
                                <p className={`text-xs ${
                                  new Date(planli.vade) < new Date() ? 'text-rose-400' : 'text-amber-400'
                                }`}>
                                  Vade: {formatDateTR(planli.vade)}
                                  {new Date(planli.vade) < new Date() && ' ‚ö†Ô∏è GE√áMƒ∞≈û'}
                                  {planli.hatirlatici && ' üîî'}
                                </p>
                              </div>
                              <p className="text-amber-400 font-bold">{formatMoney(planli.amount)}</p>
                            </div>
                            <button
                              onClick={() => tamamlaPlanliOdeme(planli)}
                              className="w-full bg-emerald-500 hover:bg-emerald-600 text-white py-2 rounded-lg text-sm font-medium transition-all"
                            >
                              ‚úì √ñdemeyi Tamamla
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* ƒ∞≈ülem Ge√ßmi≈üi */}
                  <div>
                    <p className="text-gray-400 text-sm mb-2">ƒ∞≈ülem Ge√ßmi≈üi</p>
                    <div className="space-y-2 max-h-48 overflow-y-auto">
                      {cariIslemler.filter(i => i.cariId === selectedCari.id).length === 0 ? (
                        <p className="text-gray-500 text-center py-4">Hen√ºz i≈ülem yok</p>
                      ) : (
                        cariIslemler.filter(i => i.cariId === selectedCari.id).map(islem => (
                          <div key={islem.id} className={`flex items-center justify-between p-3 rounded-xl ${
                            islem.type === 'alacak' ? 'bg-cyan-500/10' : 
                            islem.type === 'borc' ? 'bg-orange-500/10' : 'bg-emerald-500/10'
                          }`}>
                            <div>
                              <p className="text-white text-sm">
                                {islem.type === 'alacak' ? 'üì• Alacak' : islem.type === 'borc' ? 'üì§ Bor√ß' : 'üíµ √ñdeme'}
                                {islem.description && ` - ${islem.description}`}
                              </p>
                              <p className="text-gray-500 text-xs">
                                {islem.date}
                                {islem.vade && ` ‚Ä¢ Vade: ${formatDateTR(islem.vade)}`}
                              </p>
                            </div>
                            <div className="flex items-center gap-2">
                              <p className={`font-bold ${
                                islem.type === 'alacak' ? 'text-cyan-400' : 
                                islem.type === 'borc' ? 'text-orange-400' : 'text-emerald-400'
                              }`}>
                                {islem.type === 'alacak' ? '+' : '-'}{formatMoney(islem.amount)}
                              </p>
                              <button
                                onClick={() => deleteCariIslem(islem.id)}
                                className="text-gray-500 hover:text-rose-400 transition-colors"
                              >
                                üóëÔ∏è
                              </button>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  </div>

                  {/* Sil Butonu */}
                  <button
                    onClick={() => deleteCariHesap(selectedCari.id)}
                    className="w-full bg-rose-500/20 hover:bg-rose-500/30 text-rose-400 py-3 rounded-xl font-medium transition-all"
                  >
                    üóëÔ∏è Cari Hesabƒ± Sil
                  </button>
                </div>
              )}
            </Modal>

            {/* Cari ƒ∞≈ülem Ekle Modal */}
            <Modal isOpen={showCariIslemModal} onClose={() => setShowCariIslemModal(false)} title={
              newCariIslem.type === 'alacak' ? 'üì• Alacak Ekle' : 
              newCariIslem.type === 'borc' ? 'üì§ Bor√ß Ekle' : 'üíµ √ñdeme Al / Yap'
            }>
              <div className="space-y-4">
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Tutar *</label>
                  <input
                    type="number"
                    placeholder="Tutar girin"
                    value={newCariIslem.amount}
                    onChange={(e) => setNewCariIslem({...newCariIslem, amount: e.target.value})}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">A√ßƒ±klama (opsiyonel)</label>
                  <input
                    type="text"
                    placeholder="ƒ∞≈ülem a√ßƒ±klamasƒ±"
                    value={newCariIslem.description}
                    onChange={(e) => setNewCariIslem({...newCariIslem, description: e.target.value})}
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                  />
                </div>
                {newCariIslem.type === 'borc' && (
                  <div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-3">
                    <p className="text-amber-400 text-xs">
                      üí° Vade tarihi ve hatƒ±rlatƒ±cƒ±yƒ± borcu ekledikten sonra "üìÖ Planla" butonuyla ayarlayabilirsiniz.
                    </p>
                  </div>
                )}
                <button
                  onClick={addCariIslem}
                  className={`w-full py-3 rounded-xl font-medium transition-all text-white ${
                    newCariIslem.type === 'alacak' ? 'bg-cyan-500 hover:bg-cyan-600' : 
                    newCariIslem.type === 'borc' ? 'bg-orange-500 hover:bg-orange-600' : 'bg-emerald-500 hover:bg-emerald-600'
                  }`}
                >
                  {newCariIslem.type === 'alacak' ? 'Alacak Ekle' : 
                   newCariIslem.type === 'borc' ? 'Bor√ß Ekle' : '√ñdeme Kaydet'}
                </button>
              </div>
            </Modal>

            {/* ==================== √ñDEME MODAL ==================== */}
            <Modal isOpen={showOdemeModal} onClose={() => { setShowOdemeModal(false); setSelectedBorc(null); }} title="üíµ Bor√ß √ñdemesi">
              {selectedBorc && (
                <div className="space-y-4">
                  {/* Bor√ß Bilgisi */}
                  <div className="bg-orange-500/10 border border-orange-500/30 rounded-xl p-4">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <p className="text-white font-medium">{selectedBorc.description || 'Bor√ß'}</p>
                        <p className="text-gray-400 text-sm">{cariHesaplar.find(c => c.id === selectedBorc.cariId)?.name}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-orange-400 font-bold text-lg">{formatMoney(selectedBorc.kalanBorc || selectedBorc.amount)}</p>
                        {selectedBorc.vade && (
                          <p className={`text-xs ${new Date(selectedBorc.vade) < new Date() ? 'text-rose-400' : 'text-amber-400'}`}>
                            Vade: {formatDateTR(selectedBorc.vade)}
                          </p>
                        )}
                      </div>
                    </div>
                  </div>

                  {/* √ñdeme Tutarƒ± */}
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">√ñdeme Tutarƒ± *</label>
                    <input
                      type="number"
                      placeholder="Tutar girin"
                      value={odemeAmount}
                      onChange={(e) => setOdemeAmount(e.target.value)}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-emerald-500 text-lg"
                    />
                    {/* Hƒ±zlƒ± Tutar Butonlarƒ± */}
                    <div className="flex gap-2 mt-2">
                      <button
                        onClick={() => setOdemeAmount((selectedBorc.kalanBorc || selectedBorc.amount).toString())}
                        className="flex-1 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 py-2 rounded-lg text-sm transition-all"
                      >
                        Tamamƒ±
                      </button>
                      <button
                        onClick={() => setOdemeAmount(((selectedBorc.kalanBorc || selectedBorc.amount) / 2).toFixed(2))}
                        className="flex-1 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 py-2 rounded-lg text-sm transition-all"
                      >
                        Yarƒ±sƒ±
                      </button>
                      <button
                        onClick={() => setOdemeAmount(((selectedBorc.kalanBorc || selectedBorc.amount) / 4).toFixed(2))}
                        className="flex-1 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 py-2 rounded-lg text-sm transition-all"
                      >
                        √áeyreƒüi
                      </button>
                    </div>
                  </div>

                  {/* Kasa Se√ßimi */}
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">Hangi Kasadan?</label>
                    <select
                      value={odemeKasa}
                      onChange={(e) => setOdemeKasa(e.target.value)}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    >
                      {kasalar.map(kasa => (
                        <option key={kasa.id} value={kasa.id}>{kasa.icon} {kasa.name}</option>
                      ))}
                    </select>
                  </div>

                  {/* Not */}
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">Not (opsiyonel)</label>
                    <input
                      type="text"
                      placeholder="√ñdeme notu..."
                      value={odemeNote}
                      onChange={(e) => setOdemeNote(e.target.value)}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                  </div>

                  {/* √ñzet */}
                  {odemeAmount && parseFloat(odemeAmount) > 0 && (
                    <div className="bg-slate-700/50 rounded-xl p-4">
                      <div className="flex justify-between text-sm mb-1">
                        <span className="text-gray-400">√ñdenecek:</span>
                        <span className="text-emerald-400 font-bold">{formatMoney(parseFloat(odemeAmount))}</span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Kalan Bor√ß:</span>
                        <span className="text-orange-400 font-bold">
                          {formatMoney((selectedBorc.kalanBorc || selectedBorc.amount) - parseFloat(odemeAmount || 0))}
                        </span>
                      </div>
                    </div>
                  )}

                  {/* √ñdeme Butonu */}
                  <button
                    onClick={makeOdeme}
                    className="w-full bg-emerald-500 hover:bg-emerald-600 text-white py-4 rounded-xl font-medium transition-all text-lg"
                  >
                    üíµ √ñdemeyi Tamamla
                  </button>
                </div>
              )}
            </Modal>

            {/* ==================== √ñDEME PLANLAMA MODAL ==================== */}
            <Modal isOpen={showPlanlaModal} onClose={() => { setShowPlanlaModal(false); setSelectedBorc(null); }} title="üìÖ √ñdeme Planla">
              {selectedBorc && (
                <div className="space-y-4">
                  {/* Bor√ß Bilgisi */}
                  <div className="bg-orange-500/10 border border-orange-500/30 rounded-xl p-4">
                    <div className="flex justify-between items-start">
                      <div>
                        <p className="text-white font-medium">{selectedBorc.description || 'Bor√ß'}</p>
                        <p className="text-gray-400 text-sm">{cariHesaplar.find(c => c.id === selectedBorc.cariId)?.name}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-orange-400 font-bold text-lg">{formatMoney(selectedBorc.kalanBorc || selectedBorc.amount)}</p>
                        <p className="text-gray-500 text-xs">Kalan Bor√ß</p>
                      </div>
                    </div>
                  </div>

                  {/* √ñdeme Tutarƒ± */}
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">Ne Kadar √ñdeyeceksin? *</label>
                    <input
                      type="number"
                      placeholder="Tutar girin"
                      value={odemeAmount}
                      onChange={(e) => setOdemeAmount(e.target.value)}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-amber-500 text-lg"
                    />
                    <div className="flex gap-2 mt-2">
                      <button
                        onClick={() => setOdemeAmount((selectedBorc.kalanBorc || selectedBorc.amount).toString())}
                        className="flex-1 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 py-2 rounded-lg text-sm transition-all"
                      >
                        Tamamƒ±
                      </button>
                      <button
                        onClick={() => setOdemeAmount(((selectedBorc.kalanBorc || selectedBorc.amount) / 2).toFixed(2))}
                        className="flex-1 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 py-2 rounded-lg text-sm transition-all"
                      >
                        Yarƒ±sƒ±
                      </button>
                      <button
                        onClick={() => setOdemeAmount(((selectedBorc.kalanBorc || selectedBorc.amount) / 4).toFixed(2))}
                        className="flex-1 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 py-2 rounded-lg text-sm transition-all"
                      >
                        √áeyreƒüi
                      </button>
                    </div>
                  </div>

                  {/* Vade Tarihi */}
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">Ne Zaman √ñdeyeceksin? *</label>
                    <input
                      type="date"
                      value={odemeVade}
                      onChange={(e) => setOdemeVade(e.target.value)}
                      min={new Date().toISOString().split('T')[0]}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-amber-500"
                    />
                  </div>

                  {/* Hatƒ±rlatƒ±cƒ± */}
                  <div className="space-y-3">
                    <div className={`flex items-center gap-3 p-4 rounded-xl transition-all cursor-pointer ${
                      odemeHatirlatici ? 'bg-amber-500/20 border border-amber-500/30' : 'bg-white/5 border border-white/10'
                    }`} onClick={() => setOdemeHatirlatici(!odemeHatirlatici)}>
                      <input
                        type="checkbox"
                        checked={odemeHatirlatici}
                        onChange={(e) => setOdemeHatirlatici(e.target.checked)}
                        className="w-5 h-5 rounded accent-amber-500"
                      />
                      <div>
                        <p className={`font-medium ${odemeHatirlatici ? 'text-amber-400' : 'text-gray-400'}`}>
                          üîî Hatƒ±rlat
                        </p>
                        <p className="text-gray-500 text-xs">Vade tarihinden √∂nce bildirim al</p>
                      </div>
                    </div>
                    
                    {/* G√ºn Se√ßimi */}
                    {odemeHatirlatici && (
                      <div className="flex flex-wrap gap-2">
                        {[1, 2, 3, 5, 7].map(gun => (
                          <button
                            key={gun}
                            type="button"
                            onClick={() => setOdemeHatirlaticiGun(gun)}
                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                              odemeHatirlaticiGun === gun
                                ? 'bg-amber-500 text-white'
                                : 'bg-white/5 text-gray-400 hover:bg-white/10'
                            }`}
                          >
                            {gun} g√ºn √∂nce
                          </button>
                        ))}
                      </div>
                    )}
                  </div>

                  {/* Tekrar Se√ßeneƒüi */}
                  <div>
                    <label className="text-gray-400 text-sm mb-2 block">√ñdeme T√ºr√º</label>
                    <div className="grid grid-cols-2 gap-3">
                      <button
                        type="button"
                        onClick={() => setOdemeTekrar('tek')}
                        className={`flex items-center justify-center gap-2 py-3 px-4 rounded-xl font-medium transition-all ${
                          odemeTekrar === 'tek'
                            ? 'bg-indigo-500 text-white border border-indigo-400'
                            : 'bg-white/5 text-gray-400 border border-white/10 hover:bg-white/10'
                        }`}
                      >
                        <span>1Ô∏è‚É£</span>
                        <span>Tek Seferlik</span>
                      </button>
                      <button
                        type="button"
                        onClick={() => setOdemeTekrar('aylik')}
                        className={`flex items-center justify-center gap-2 py-3 px-4 rounded-xl font-medium transition-all ${
                          odemeTekrar === 'aylik'
                            ? 'bg-purple-500 text-white border border-purple-400'
                            : 'bg-white/5 text-gray-400 border border-white/10 hover:bg-white/10'
                        }`}
                      >
                        <span>üîÑ</span>
                        <span>Her Ay Tekrar</span>
                      </button>
                    </div>
                    <p className="text-gray-500 text-xs mt-2">
                      {odemeTekrar === 'tek' 
                        ? 'üí° Bu √∂deme sadece bir kez yapƒ±lacak' 
                        : 'üí° Bu √∂deme her ay aynƒ± tarihte tekrarlanacak'}
                    </p>
                  </div>

                  {/* Not */}
                  <div>
                    <label className="text-gray-400 text-sm mb-1 block">Not (opsiyonel)</label>
                    <input
                      type="text"
                      placeholder="√ñdeme notu..."
                      value={odemeNote}
                      onChange={(e) => setOdemeNote(e.target.value)}
                      className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                  </div>

                  {/* √ñzet */}
                  {odemeAmount && odemeVade && (
                    <div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4">
                      <p className="text-amber-400 text-sm mb-2">üìÖ √ñdeme Planƒ±</p>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="text-gray-400">√ñdenecek:</span>
                        <span className="text-amber-400 font-bold">{formatMoney(parseFloat(odemeAmount))}</span>
                      </div>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="text-gray-400">Vade:</span>
                        <span className="text-white">{formatDateTR(odemeVade)}</span>
                      </div>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="text-gray-400">Hatƒ±rlatƒ±cƒ±:</span>
                        <span className={odemeHatirlatici ? 'text-amber-400' : 'text-gray-500'}>
                          {odemeHatirlatici ? `üîî ${odemeHatirlaticiGun} g√ºn √∂nce` : 'Kapalƒ±'}
                        </span>
                      </div>
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-400">Tekrar:</span>
                        <span className={odemeTekrar === 'aylik' ? 'text-purple-400' : 'text-indigo-400'}>
                          {odemeTekrar === 'aylik' ? 'üîÑ Her Ay' : '1Ô∏è‚É£ Tek Seferlik'}
                        </span>
                      </div>
                    </div>
                  )}

                  {/* Planla Butonu */}
                  <button
                    onClick={planlaOdeme}
                    className="w-full bg-amber-500 hover:bg-amber-600 text-white py-4 rounded-xl font-medium transition-all text-lg"
                  >
                    üìÖ √ñdemeyi Planla
                  </button>
                </div>
              )}
            </Modal>

            {/* ==================== KASA EKLEME MODAL ==================== */}
            <Modal isOpen={showKasaModal} onClose={() => { setShowKasaModal(false); setEditingKasa(null); setNewKasaName(''); setNewKasaIsMain(true); }} title="üè¶ Kasalarƒ± Y√∂net">
              <div className="space-y-4">
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Yeni Kasa Adƒ±</label>
                  <div className="flex gap-2">
                    <input
                      type="text"
                      placeholder="√ñrn: D√∂viz Hesabƒ±, Yastƒ±k Altƒ±..."
                      value={newKasaName}
                      onChange={(e) => setNewKasaName(e.target.value)}
                      className="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                    <button
                      onClick={addKasa}
                      className="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-3 rounded-xl font-medium transition-all"
                    >
                      Ekle
                    </button>
                  </div>
                  {/* Ana Kasaya Dahil Checkbox */}
                  <label className="flex items-center gap-3 mt-3 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={newKasaIsMain}
                      onChange={(e) => setNewKasaIsMain(e.target.checked)}
                      className="w-5 h-5 rounded accent-emerald-500"
                    />
                    <span className="text-gray-300 text-sm">Ana kasaya dahil et (toplam bakiyeye eklensin)</span>
                  </label>
                </div>

                {/* Bilgi */}
                <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-3">
                  <p className="text-blue-400 text-xs">
                    üí° "Ana kasaya dahil" se√ßili olmayan kasalar toplam bakiyeye dahil edilmez, ayrƒ± takip edilir.
                  </p>
                </div>
                
                {/* Mevcut Kasalar */}
                <div className="border-t border-white/10 pt-4">
                  <p className="text-gray-400 text-sm mb-3">Mevcut Kasalar:</p>
                  <div className="space-y-2">
                    {kasalar.map(kasa => (
                      <div key={kasa.id} className={`flex items-center justify-between p-3 rounded-xl ${kasa.isMainKasa !== false ? 'bg-white/5' : 'bg-amber-500/10 border border-amber-500/30'}`}>
                        {editingKasa === kasa.id ? (
                          <input
                            type="text"
                            defaultValue={kasa.name}
                            onBlur={(e) => updateKasa(kasa.id, e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && updateKasa(kasa.id, e.target.value)}
                            autoFocus
                            className="flex-1 bg-white/10 border border-indigo-500 rounded-lg px-3 py-1 text-white focus:outline-none mr-2"
                          />
                        ) : (
                          <div className="flex items-center gap-2">
                            <span>{kasa.icon}</span>
                            <div>
                              <span className="text-white">{kasa.name}</span>
                              {kasa.isMainKasa === false && (
                                <span className="ml-2 text-xs text-amber-400">(Harici)</span>
                              )}
                            </div>
                          </div>
                        )}
                        <div className="flex items-center gap-2">
                          <span className="text-gray-400 text-sm">{formatMoney(kasaBakiyeleri[kasa.id] || 0)}</span>
                          {kasa.id !== 'nakit' && kasa.id !== 'kredikarti' && (
                            <>
                              <button
                                onClick={() => toggleKasaMain(kasa.id)}
                                className={`text-sm px-2 py-1 rounded ${kasa.isMainKasa !== false ? 'text-emerald-400 hover:bg-emerald-500/20' : 'text-amber-400 hover:bg-amber-500/20'}`}
                                title={kasa.isMainKasa !== false ? 'Ana kasadan √ßƒ±kar' : 'Ana kasaya dahil et'}
                              >
                                {kasa.isMainKasa !== false ? '‚úì' : '‚óã'}
                              </button>
                              <button
                                onClick={() => setEditingKasa(editingKasa === kasa.id ? null : kasa.id)}
                                className="text-gray-500 hover:text-blue-400 transition-colors"
                              >
                                ‚úèÔ∏è
                              </button>
                              <button
                                onClick={() => deleteKasa(kasa.id)}
                                className="text-gray-500 hover:text-rose-400 transition-colors"
                              >
                                üóëÔ∏è
                              </button>
                            </>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </Modal>

            {/* ==================== Gƒ∞DER KATEGORƒ∞Sƒ∞ MODAL ==================== */}
            <Modal isOpen={showGiderKategoriModal} onClose={() => { setShowGiderKategoriModal(false); setEditingGiderKat(null); }} title="üìÇ Gider Kategorileri">
              <div className="space-y-4">
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Yeni Kategori Adƒ±</label>
                  <div className="flex gap-2">
                    <input
                      type="text"
                      placeholder="√ñrn: Kira, Sigorta, Vergi..."
                      value={newGiderKategori}
                      onChange={(e) => setNewGiderKategori(e.target.value)}
                      className="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                    <button
                      onClick={addGiderKategori}
                      className="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-3 rounded-xl font-medium transition-all"
                    >
                      Ekle
                    </button>
                  </div>
                </div>
                
                {/* Mevcut Kategoriler */}
                <div className="border-t border-white/10 pt-4">
                  <p className="text-gray-400 text-sm mb-3">Mevcut Gider Kategorileri:</p>
                  <div className="space-y-2">
                    {giderKategorileri.map(kat => (
                      <div key={kat} className="flex items-center justify-between bg-white/5 p-3 rounded-xl">
                        {editingGiderKat === kat ? (
                          <input
                            type="text"
                            defaultValue={kat}
                            onBlur={(e) => updateGiderKategori(kat, e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && updateGiderKategori(kat, e.target.value)}
                            autoFocus
                            className="flex-1 bg-white/10 border border-indigo-500 rounded-lg px-3 py-1 text-white focus:outline-none mr-2"
                          />
                        ) : (
                          <span className="text-white">{kat}</span>
                        )}
                        <div className="flex items-center gap-2">
                          <button
                            onClick={() => setEditingGiderKat(editingGiderKat === kat ? null : kat)}
                            className="text-gray-500 hover:text-blue-400 transition-colors"
                          >
                            ‚úèÔ∏è
                          </button>
                          <button
                            onClick={() => deleteGiderKategori(kat)}
                            className="text-gray-500 hover:text-rose-400 transition-colors"
                          >
                            üóëÔ∏è
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </Modal>

            {/* ==================== GELƒ∞R KATEGORƒ∞Sƒ∞ MODAL ==================== */}
            <Modal isOpen={showGelirKategoriModal} onClose={() => { setShowGelirKategoriModal(false); setEditingGelirKat(null); }} title="üìÇ Gelir Kategorileri">
              <div className="space-y-4">
                <div>
                  <label className="text-gray-400 text-sm mb-1 block">Yeni Kategori Adƒ±</label>
                  <div className="flex gap-2">
                    <input
                      type="text"
                      placeholder="√ñrn: Danƒ±≈ümanlƒ±k, Muayene..."
                      value={newGelirKategori}
                      onChange={(e) => setNewGelirKategori(e.target.value)}
                      className="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-white/30"
                    />
                    <button
                      onClick={addGelirKategori}
                      className="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-3 rounded-xl font-medium transition-all"
                    >
                      Ekle
                    </button>
                  </div>
                </div>
                
                {/* Mevcut Kategoriler */}
                <div className="border-t border-white/10 pt-4">
                  <p className="text-gray-400 text-sm mb-3">Mevcut Gelir Kategorileri:</p>
                  <div className="space-y-2">
                    {gelirKategorileri.map(kat => (
                      <div key={kat} className="flex items-center justify-between bg-white/5 p-3 rounded-xl">
                        {editingGelirKat === kat ? (
                          <input
                            type="text"
                            defaultValue={kat}
                            onBlur={(e) => updateGelirKategori(kat, e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && updateGelirKategori(kat, e.target.value)}
                            autoFocus
                            className="flex-1 bg-white/10 border border-emerald-500 rounded-lg px-3 py-1 text-white focus:outline-none mr-2"
                          />
                        ) : (
                          <span className="text-white">{kat}</span>
                        )}
                        <div className="flex items-center gap-2">
                          <button
                            onClick={() => setEditingGelirKat(editingGelirKat === kat ? null : kat)}
                            className="text-gray-500 hover:text-blue-400 transition-colors"
                          >
                            ‚úèÔ∏è
                          </button>
                          <button
                            onClick={() => deleteGelirKategori(kat)}
                            className="text-gray-500 hover:text-rose-400 transition-colors"
                          >
                            üóëÔ∏è
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </Modal>

            {/* ==================== BULUT SYNC MODAL ==================== */}
            <Modal isOpen={showSyncModal} onClose={() => setShowSyncModal(false)} title="‚òÅÔ∏è Bulut Senkronizasyon">
              <div className="space-y-4">
                {/* Smart Polling Durum G√∂stergesi */}
                <div className={`rounded-xl p-4 ${
                  syncStatus === SYNC_STATUS.SYNCED ? 'bg-emerald-500/10 border border-emerald-500/30' :
                  syncStatus === SYNC_STATUS.SYNCING ? 'bg-blue-500/10 border border-blue-500/30' :
                  syncStatus === SYNC_STATUS.PENDING ? 'bg-amber-500/10 border border-amber-500/30' :
                  syncStatus === SYNC_STATUS.CONFLICT ? 'bg-orange-500/10 border border-orange-500/30' :
                  syncStatus === SYNC_STATUS.OFFLINE ? 'bg-rose-500/10 border border-rose-500/30' :
                  'bg-white/5'
                }`}>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-gray-300">Durum:</span>
                    <span className={`flex items-center gap-2 ${
                      syncStatus === SYNC_STATUS.SYNCED ? 'text-emerald-400' :
                      syncStatus === SYNC_STATUS.SYNCING ? 'text-blue-400' :
                      syncStatus === SYNC_STATUS.PENDING ? 'text-amber-400' :
                      syncStatus === SYNC_STATUS.CONFLICT ? 'text-orange-400' :
                      syncStatus === SYNC_STATUS.OFFLINE ? 'text-rose-400' :
                      !syncEnabled ? 'text-gray-500' : 'text-emerald-400'
                    }`}>
                      <span className="text-lg">
                        {syncStatus === SYNC_STATUS.SYNCED ? 'üü¢' :
                         syncStatus === SYNC_STATUS.SYNCING ? 'üîµ' :
                         syncStatus === SYNC_STATUS.PENDING ? 'üü°' :
                         syncStatus === SYNC_STATUS.CONFLICT ? 'üü†' :
                         syncStatus === SYNC_STATUS.OFFLINE ? 'üî¥' : '‚ö™'}
                      </span>
                      {!syncEnabled ? 'Kapalƒ±' :
                       syncStatus === SYNC_STATUS.SYNCED ? 'Senkron' :
                       syncStatus === SYNC_STATUS.SYNCING ? 'Y√ºkleniyor...' :
                       syncStatus === SYNC_STATUS.PENDING ? 'Deƒüi≈üiklik bekliyor' :
                       syncStatus === SYNC_STATUS.CONFLICT ? '√áakƒ±≈üma var!' :
                       syncStatus === SYNC_STATUS.OFFLINE ? 'Baƒülantƒ± yok' : 'Aktif'}
                    </span>
                  </div>
                  
                  {/* Otomatik Sync Bilgisi */}
                  {syncEnabled && (
                    <div className="flex items-center justify-between text-sm mb-2">
                      <span className="text-gray-400">Otomatik Kontrol:</span>
                      <span className="text-emerald-400">Her 10 saniyede</span>
                    </div>
                  )}
                  
                  {lastSyncTime && (
                    <div className="flex items-center justify-between text-sm">
                      <span className="text-gray-400">Son Sync:</span>
                      <span className="text-white">{lastSyncTime.toLocaleString('tr-TR')}</span>
                    </div>
                  )}
                  {binId && (
                    <div className="mt-3 pt-3 border-t border-white/10">
                      <p className="text-gray-400 text-xs mb-1">Bin ID (ba≈üka cihazda kullanmak i√ßin):</p>
                      <div className="flex gap-2">
                        <code className="flex-1 bg-black/30 text-emerald-400 px-3 py-2 rounded-lg text-xs break-all">{binId}</code>
                        <button
                          onClick={() => { navigator.clipboard.writeText(binId); showToast('Kopyalandƒ±!', 'success'); }}
                          className="bg-white/10 hover:bg-white/20 text-white px-3 py-2 rounded-lg text-sm"
                        >
                          üìã
                        </button>
                      </div>
                    </div>
                  )}
                </div>

                {/* Smart Polling A√ßƒ±klama */}
                <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                  <p className="text-blue-400 text-sm">
                    ‚ÑπÔ∏è <strong>Ger√ßek Zamanlƒ± Sync:</strong> Verileriniz her 10 saniyede otomatik kontrol edilir. Ba≈üka bir cihazda deƒüi≈üiklik yapƒ±ldƒ±ƒüƒ±nda anƒ±nda g√ºncellenir!
                  </p>
                </div>

                {!syncEnabled ? (
                  <>
                    {/* Senkronizasyonu Ba≈ülat */}
                    <button
                      onClick={enableSync}
                      disabled={isSyncing}
                      className="w-full bg-emerald-500 hover:bg-emerald-600 text-white py-3 rounded-xl font-medium transition-all disabled:opacity-50"
                    >
                      {isSyncing ? 'Kaydediliyor...' : '‚òÅÔ∏è Senkronizasyonu Ba≈ülat'}
                    </button>

                    {/* Ba≈üka Cihazdan Veri √áek */}
                    <div className="border-t border-white/10 pt-4">
                      <p className="text-gray-400 text-sm mb-2">Ba≈üka cihazdan veri √ßekmek i√ßin Bin ID girin:</p>
                      <div className="flex gap-2">
                        <input
                          type="text"
                          id="importBinId"
                          placeholder="Bin ID yapƒ±≈ütƒ±r..."
                          className="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500"
                        />
                        <button
                          onClick={() => importFromBinId(document.getElementById('importBinId').value)}
                          disabled={isSyncing}
                          className="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-3 rounded-xl font-medium transition-all disabled:opacity-50"
                        >
                          {isSyncing ? '...' : 'Y√ºkle'}
                        </button>
                      </div>
                    </div>
                  </>
                ) : (
                  <>
                    {/* Manuel Sync */}
                    <button
                      onClick={() => saveToCloud(true)}
                      disabled={isSyncing}
                      className="w-full bg-emerald-500 hover:bg-emerald-600 text-white py-3 rounded-xl font-medium transition-all disabled:opacity-50"
                    >
                      {isSyncing ? 'Senkronize ediliyor...' : 'üîÑ ≈ûimdi Senkronize Et'}
                    </button>

                    {/* Buluttan Y√ºkle */}
                    <button
                      onClick={loadFromCloud}
                      disabled={isSyncing}
                      className="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-medium transition-all disabled:opacity-50"
                    >
                      {isSyncing ? '...' : 'üì• Buluttan Y√ºkle'}
                    </button>

                    {/* Bin ID Deƒüi≈ütir */}
                    <div className="border-t border-white/10 pt-4">
                      <p className="text-gray-400 text-sm mb-2">üîó Ba≈üka cihazƒ±n Bin ID'sini kullan:</p>
                      <div className="flex gap-2">
                        <input
                          type="text"
                          id="changeBinId"
                          placeholder="Bin ID yapƒ±≈ütƒ±r..."
                          className="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500 text-sm"
                        />
                        <button
                          onClick={() => {
                            const newBinId = document.getElementById('changeBinId').value.trim();
                            if (!newBinId) {
                              showToast('Bin ID girin', 'error');
                              return;
                            }
                            if (confirm('‚ö†Ô∏è Dƒ∞KKAT: Bu i≈ülem mevcut verilerinizi silip, girdiƒüiniz Bin ID\'deki verileri y√ºkleyecek. Devam etmek istiyor musunuz?')) {
                              localStorage.setItem('gelir-gider-bin-id', newBinId);
                              setBinId(newBinId);
                              document.getElementById('changeBinId').value = '';
                              showToast('Bin ID deƒüi≈ütirildi, veriler y√ºkleniyor...', 'info');
                              setTimeout(() => loadFromCloud(), 500);
                            }
                          }}
                          className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-xl font-medium transition-all"
                        >
                          Deƒüi≈ütir
                        </button>
                      </div>
                      <p className="text-gray-500 text-xs mt-2">üí° Diƒüer cihazdan Bin ID'yi kopyalayƒ±p buraya yapƒ±≈ütƒ±rƒ±n</p>
                    </div>

                    {/* Senkronizasyonu Kapat */}
                    <button
                      onClick={disableSync}
                      className="w-full bg-rose-500/20 hover:bg-rose-500/30 text-rose-400 py-3 rounded-xl font-medium transition-all"
                    >
                      Senkronizasyonu Kapat
                    </button>
                  </>
                )}

                {/* ==================== TEMA AYARLARI ==================== */}
                <div className="border-t border-white/10 pt-4 mt-4">
                  <p className="text-gray-400 text-sm mb-3">üé® Tema Ayarlarƒ±</p>
                  <div className="grid grid-cols-2 gap-3">
                    <button
                      onClick={() => setDarkMode(!darkMode)}
                      className={`flex items-center justify-center gap-2 py-3 rounded-xl font-medium transition-all ${
                        darkMode 
                          ? 'bg-slate-700 text-yellow-400 border border-yellow-500/30' 
                          : 'bg-amber-100 text-amber-700 border border-amber-300'
                      }`}
                    >
                      {darkMode ? 'üåô Koyu Tema' : '‚òÄÔ∏è A√ßƒ±k Tema'}
                    </button>
                    <button
                      onClick={() => setVividColors(!vividColors)}
                      className={`flex items-center justify-center gap-2 py-3 rounded-xl font-medium transition-all ${
                        vividColors 
                          ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white border border-purple-400' 
                          : 'bg-slate-600 text-gray-300 border border-slate-500'
                      }`}
                    >
                      {vividColors ? 'üåà Canlƒ± Renkler' : 'üé® Pastel Renkler'}
                    </button>
                  </div>
                </div>
              </div>
            </Modal>

            {/* ==================== √áAKI≈ûMA MODAL ==================== */}
            <Modal isOpen={showConflictModal} onClose={() => setShowConflictModal(false)} title="‚ö†Ô∏è Veri √áakƒ±≈ümasƒ±">
              <div className="space-y-4">
                <div className="bg-orange-500/10 border border-orange-500/30 rounded-xl p-4">
                  <p className="text-orange-400 text-sm">
                    ‚ö†Ô∏è Hem bu cihazda hem de ba≈üka bir cihazda deƒüi≈üiklik yapƒ±lmƒ±≈ü! Hangi veriyi kullanmak istediƒüinizi se√ßin.
                  </p>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  {/* Buluttaki Veri */}
                  <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                    <p className="text-blue-400 font-medium mb-2">‚òÅÔ∏è Buluttaki Veri</p>
                    <p className="text-gray-400 text-xs mb-3">
                      Son g√ºncelleme: {conflictData?.lastModified ? new Date(conflictData.lastModified).toLocaleString('tr-TR') : '-'}
                    </p>
                    <p className="text-gray-300 text-sm">
                      {conflictData?.transactions?.length || 0} i≈ülem
                    </p>
                  </div>

                  {/* Lokal Veri */}
                  <div className="bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4">
                    <p className="text-emerald-400 font-medium mb-2">üíª Bu Cihazdaki Veri</p>
                    <p className="text-gray-400 text-xs mb-3">
                      Son g√ºncelleme: {new Date(localTimestamp).toLocaleString('tr-TR')}
                    </p>
                    <p className="text-gray-300 text-sm">
                      {transactions.length} i≈ülem
                    </p>
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3 pt-2">
                  <button
                    onClick={resolveConflictUseCloud}
                    className="bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-medium transition-all"
                  >
                    ‚òÅÔ∏è Bulutu Kullan
                  </button>
                  <button
                    onClick={resolveConflictUseLocal}
                    className="bg-emerald-500 hover:bg-emerald-600 text-white py-3 rounded-xl font-medium transition-all"
                  >
                    üíª Lokali Kullan
                  </button>
                </div>
              </div>
            </Modal>

            {/* Footer */}
            <p className="text-gray-600 text-center text-sm mt-6 no-print">
              {syncEnabled ? (
                <span className="flex items-center justify-center gap-2">
                  <span className={
                    syncStatus === SYNC_STATUS.SYNCED ? 'text-emerald-500' :
                    syncStatus === SYNC_STATUS.PENDING ? 'text-amber-500' :
                    syncStatus === SYNC_STATUS.OFFLINE ? 'text-rose-500' : 'text-blue-500'
                  }>
                    {syncStatus === SYNC_STATUS.SYNCED ? 'üü¢' :
                     syncStatus === SYNC_STATUS.PENDING ? 'üü°' :
                     syncStatus === SYNC_STATUS.OFFLINE ? 'üî¥' : 'üîµ'}
                  </span>
                  <span>
                    {syncStatus === SYNC_STATUS.SYNCED ? 'Ger√ßek zamanlƒ± sync aktif' :
                     syncStatus === SYNC_STATUS.PENDING ? 'Deƒüi≈üiklikler kaydediliyor...' :
                     syncStatus === SYNC_STATUS.SYNCING ? 'Senkronize ediliyor...' :
                     syncStatus === SYNC_STATUS.OFFLINE ? 'Baƒülantƒ± bekleniyor...' :
                     'Sync aktif'}
                  </span>
                  <span className="text-gray-600">‚Ä¢</span>
                  <span>Uygulamayƒ± telefonunuza ekleyebilirsiniz</span>
                </span>
              ) : (
                <span>Veriler otomatik kaydedilir ‚Ä¢ Uygulamayƒ± telefonunuza ekleyebilirsiniz</span>
              )}
            </p>
          </div>
        </div>
      );
    }

    // ==================== ANA APP WRAPPER ====================
    function App() {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [storedUser, setStoredUser] = useState(() => {
        const saved = localStorage.getItem('app-user');
        return saved ? JSON.parse(saved) : null;
      });

      const handleSetUser = (userData) => {
        localStorage.setItem('app-user', JSON.stringify(userData));
        setStoredUser(userData);
      };

      if (!isLoggedIn) {
        return <LoginScreen onLogin={() => setIsLoggedIn(true)} storedUser={storedUser} onSetUser={handleSetUser} />;
      }

      return <GelirGiderApp />;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
